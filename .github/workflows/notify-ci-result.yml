name: CI結果通知(テスト)

on:
  workflow_run:
    workflows:
      - "build"
    types:
      - completed

jobs:
  notify-ci-result:
    runs-on: ubuntu-latest
    steps:
      - name: Simple Test
        run: |
          echo "✅ Build workflow completed!"
          echo "Event: ${{ github.event.workflow_run.event }}"
          echo "Head branch: ${{ github.event.workflow_run.head_branch }}"
          echo "Conclusion: ${{ github.event.workflow_run.conclusion }}"
          
      - name: Test Slack notification
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          echo "Testing Slack notification..."
          if [ "${{ github.event.workflow_run.conclusion }}" = "success" ]; then
            MESSAGE="✅ Build succeeded! Branch: ${{ github.event.workflow_run.head_branch }}"
          else
            MESSAGE="❌ Build failed! Branch: ${{ github.event.workflow_run.head_branch }}"
          fi
          
          echo "Sending message: $MESSAGE"
          curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\":\"$MESSAGE\"}" \
            $SLACK_WEBHOOK_URL