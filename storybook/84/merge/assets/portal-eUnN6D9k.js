import{c as Q}from"./factory-DSzOyGgl.js";import{c as Z,u as ee}from"./create-slot-recipe-context-ihoqZrZU.js";import{b as te,a7 as ne,a8 as re,r as G,a6 as se,T as oe,aA as ue,ad as ae,aB as ce,aC as U,aD as D,aE as ie,aq as k,w as H,aF as le,aG as fe,al as de,ae as me}from"./index-D2YlXA01.js";import{c as ge,a as pe}from"./index-CrjboX4Z.js";import{r as a}from"./index-BXymfbzT.js";import{j as h}from"./create-recipe-context-oy0ofMwS.js";import{r as Ne}from"./index-DGKHe-6Q.js";const[qe,we]=Q({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}}),De=e=>Z()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]);function ve(e,t){const{state:o,send:r,context:i}=e,c=o.matches("mounted","unmountSuspended");return{skip:!i.get("initial"),present:c,setNode(m){m&&r({type:"NODE.SET",node:m})},unmount(){r({type:"UNMOUNT"})}}}var Ee=te({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,action:t,prop:o}){e([()=>o("present")],()=>{t(["setInitial","syncPresence"])})},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},invokeOnExitComplete:({prop:e})=>{var t;(t=e("onExitComplete"))==null||t()},setNode:({refs:e,event:t})=>{e.set("node",t.node)},setStyles:({refs:e,event:t})=>{e.set("styles",se(t.node))},syncPresence:({context:e,refs:t,send:o,prop:r})=>{const i=r("present");if(i)return o({type:"MOUNT",src:"presence.changed"});const c=t.get("node");if(!i&&(c==null?void 0:c.ownerDocument.visibilityState)==="hidden")return o({type:"UNMOUNT",src:"visibilitychange"});G(()=>{var f,g;const m=V(t.get("styles"));e.set("unmountAnimationName",m),m==="none"||m===e.get("prevAnimationName")||((f=t.get("styles"))==null?void 0:f.display)==="none"||((g=t.get("styles"))==null?void 0:g.animationDuration)==="0s"?o({type:"UNMOUNT",src:"presence.changed"}):o({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{G(()=>{e.set("prevAnimationName",V(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:o})=>{const r=t.get("node");if(!r)return;const i=f=>{var l,R;(((R=(l=f.composedPath)==null?void 0:l.call(f))==null?void 0:R[0])??f.target)===r&&e.set("prevAnimationName",V(t.get("styles")))},c=f=>{const g=V(t.get("styles"));oe(f)===r&&g===e.get("unmountAnimationName")&&o({type:"UNMOUNT",src:"animationend"})};r.addEventListener("animationstart",i),r.addEventListener("animationcancel",c),r.addEventListener("animationend",c);const m=ne(r,{animationFillMode:"forwards"});return()=>{r.removeEventListener("animationstart",i),r.removeEventListener("animationcancel",c),r.removeEventListener("animationend",c),re(()=>m())}}}}});function V(e){return(e==null?void 0:e.animationName)||"none"}ge()(["onExitComplete","present","immediate"]);var w=Ne(),W=typeof globalThis.document<"u"?a.useLayoutEffect:a.useEffect;function q(e){const t=e().value??e().defaultValue,o=e().isEqual??Object.is,[r]=a.useState(t),[i,c]=a.useState(r),m=e().value!==void 0,f=a.useRef(i);f.current=m?e().value:i;const g=a.useRef(f.current);W(()=>{g.current=f.current},[i,e().value]);const l=N=>{var C,O;const v=g.current,E=k(N)?N(v):N;e().debug&&console.log(`[bindable > ${e().debug}] setValue`,{next:E,prev:v}),m||c(E),o(E,v)||(O=(C=e()).onChange)==null||O.call(C,E,v)};function R(){return m?e().value:i}return{initial:r,ref:f,get:R,set(N){(e().sync?w.flushSync:ie)(()=>l(N))},invoke(N,v){var E,C;(C=(E=e()).onChange)==null||C.call(E,N,v)},hash(N){var v,E;return((E=(v=e()).hash)==null?void 0:E.call(v,N))??String(N)}}}q.cleanup=e=>{a.useEffect(()=>e,[])};q.ref=e=>{const t=a.useRef(e);return{get:()=>t.current,set:o=>{t.current=o}}};function Se(e){const t=a.useRef(e);return{get(o){return t.current[o]},set(o,r){t.current[o]=r}}}var ye=(e,t)=>{const o=a.useRef(!1),r=a.useRef(!1);a.useEffect(()=>{if(o.current&&r.current)return t();r.current=!0},[...(e??[]).map(i=>typeof i=="function"?i():i)]),a.useEffect(()=>(o.current=!0,()=>{o.current=!1}),[])};function xe(e,t={}){var $,B,J,_;const o=a.useMemo(()=>{const{id:s,ids:n,getRootNode:u}=t;return ue({id:s,ids:n,getRootNode:u})},[t]),r=(...s)=>{e.debug&&console.log(...s)},i=(($=e.props)==null?void 0:$.call(e,{props:ae(t),scope:o}))??t,c=Pe(i),m=(B=e.context)==null?void 0:B.call(e,{prop:c,bindable:q,scope:o,flush:K,getContext(){return g},getComputed(){return L},getRefs(){return O}}),f=X(m),g={get(s){var n;return(n=f.current)==null?void 0:n[s].ref.current},set(s,n){var u;(u=f.current)==null||u[s].set(n)},initial(s){var n;return(n=f.current)==null?void 0:n[s].initial},hash(s){var u,d;const n=(u=f.current)==null?void 0:u[s].get();return(d=f.current)==null?void 0:d[s].hash(n)}},l=a.useRef(new Map),R=a.useRef(null),N=a.useRef(null),v=a.useRef({type:""}),E=()=>({...v.current,current(){return v.current},previous(){return N.current}}),C=()=>({...y,matches(...s){return s.includes(y.ref.current)},hasTag(s){var n,u;return!!((u=(n=e.states[y.ref.current])==null?void 0:n.tags)!=null&&u.includes(s))}}),O=Se(((J=e.refs)==null?void 0:J.call(e,{prop:c,context:g}))??{}),M=()=>({state:C(),context:g,event:E(),prop:c,send:I,action:A,guard:j,track:ye,refs:O,computed:L,flush:K,scope:o,choose:b}),A=s=>{const n=k(s)?s(M()):s;if(!n)return;const u=n.map(d=>{var S,P;const p=(P=(S=e.implementations)==null?void 0:S.actions)==null?void 0:P[d];return p||H(`[zag-js] No implementation found for action "${JSON.stringify(d)}"`),p});for(const d of u)d==null||d(M())},j=s=>{var n,u;return k(s)?s(M()):(u=(n=e.implementations)==null?void 0:n.guards)==null?void 0:u[s](M())},z=s=>{const n=k(s)?s(M()):s;if(!n)return;const u=n.map(p=>{var P,x;const S=(x=(P=e.implementations)==null?void 0:P.effects)==null?void 0:x[p];return S||H(`[zag-js] No implementation found for effect "${JSON.stringify(p)}"`),S}),d=[];for(const p of u){const S=p==null?void 0:p(M());S&&d.push(S)}return()=>d.forEach(p=>p==null?void 0:p())},b=s=>le(s).find(n=>{let u=!n.guard;return fe(n.guard)?u=!!j(n.guard):k(n.guard)&&(u=n.guard(M())),u}),L=s=>{ce(e.computed,()=>"[zag-js] No computed object found on machine");const n=e.computed[s];return n({context:g,event:E(),prop:c,refs:O,scope:o,computed:L})},y=q(()=>({defaultValue:e.initialState({prop:c}),onChange(s,n){var d,p,S,P;if(n){const x=l.current.get(n);x==null||x(),l.current.delete(n)}n&&A((d=e.states[n])==null?void 0:d.exit),A((p=R.current)==null?void 0:p.actions);const u=z((S=e.states[s])==null?void 0:S.effects);if(u&&l.current.set(s,u),n===D){A(e.entry);const x=z(e.effects);x&&l.current.set(D,x)}A((P=e.states[s])==null?void 0:P.entry)}})),F=a.useRef(void 0),T=a.useRef(U.NotStarted);W(()=>{queueMicrotask(()=>{const u=T.current===U.Started;T.current=U.Started,r(u?"rehydrating...":"initializing...");const d=F.current??y.initial;y.invoke(d,u?y.get():D)});const s=l.current,n=y.ref.current;return()=>{r("unmounting..."),F.current=n,T.current=U.Stopped,s.forEach(u=>u==null?void 0:u()),l.current=new Map,R.current=null,queueMicrotask(()=>{A(e.exit)})}},[]);const Y=()=>"ref"in y?y.ref.current:y.get(),I=s=>{queueMicrotask(()=>{var P,x;if(T.current!==U.Started)return;N.current=v.current,v.current=s,r("send",s);let n=Y();const u=((P=e.states[n].on)==null?void 0:P[s.type])??((x=e.on)==null?void 0:x[s.type]),d=b(u);if(!d)return;R.current=d;const p=d.target??n;r("transition",d);const S=p!==n;S?w.flushSync(()=>y.set(p)):d.reenter&&!S?y.invoke(n,n):A(d.actions??[])})};return(_=e.watch)==null||_.call(e,M()),{state:C(),send:I,context:g,prop:c,scope:o,refs:O,computed:L,event:E(),getStatus:()=>T.current}}function X(e){const t=a.useRef(e);return t.current=e,t}function Pe(e){const t=X(e);return function(r){return t.current[r]}}function K(e){queueMicrotask(()=>{w.flushSync(()=>e())})}var je=pe(e=>e);function Re(e,t={}){const{sync:o=!1}=t,r=Ce(e);return a.useCallback((...i)=>{var c;return o?queueMicrotask(()=>{var m;return(m=r.current)==null?void 0:m.call(r,...i)}):(c=r.current)==null?void 0:c.call(r,...i)},[o,r])}function Ce(e){const t=a.useRef(e);return t.current=e,t}const ze=(e={})=>{const{lazyMount:t,unmountOnExit:o,present:r,skipAnimationOnMount:i=!1,...c}=e,m=a.useRef(!1),f={...c,present:r,onExitComplete:Re(e.onExitComplete)},g=xe(Ee,f),l=ve(g);l.present&&(m.current=!0);const R=!l.present&&!m.current&&t||o&&!l.present&&m.current,N=()=>({"data-state":l.skip&&i?void 0:r?"open":"closed",hidden:!l.present});return{ref:l.setNode,getPresenceProps:N,present:l.present,unmounted:R}},[be,Fe]=Q({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),Ie=e=>{var g;const{children:t,disabled:o}=e,[r,i]=a.useState((g=e.container)==null?void 0:g.current),c=a.useSyncExternalStore(Oe,()=>!1,()=>!0),{getRootNode:m}=ee();if(a.useEffect(()=>{i(()=>{var l;return(l=e.container)==null?void 0:l.current})},[e.container]),c||o)return h.jsx(h.Fragment,{children:t});const f=r??Me(m);return h.jsx(h.Fragment,{children:a.Children.map(t,l=>w.createPortal(l,f))})},Me=e=>{const t=e==null?void 0:e(),o=t.getRootNode();return de(o)?o:me(t).body},Oe=()=>()=>{};export{be as P,xe as a,Fe as b,ze as c,Ie as d,je as n,De as s,we as u};
