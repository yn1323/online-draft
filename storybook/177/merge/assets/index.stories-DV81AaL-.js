import{c as Te,d as Be,s as Ke,b as ge,T as O}from"./index.esm2017-rypblU8U.js";import{j as a}from"./stack-B25eOQea.js";import{B as Qe}from"./index-C9wqLcGi.js";import{L as Xe}from"./index-Cki5ZDSJ.js";import{u as Ye}from"./toaster-0cngzWlo.js";import{d as Je}from"./firebase-C-ezhxfZ.js";import{u as er}from"./useFirebaseAuth-Do6ND1p9.js";import{a as rr,u as or}from"./useRealtimeUsers-TL1hQYQ7.js";import{r as re,b as Se,g as tr}from"./index-BXymfbzT.js";import{a as nr}from"./_interop_require_wildcard-BpaVepTj.js";import{r as ar}from"./jsx-runtime-Bw5QeaCk.js";import{r as sr,w as ir,q as ur,s as lr,n as cr,b as dr,o as fr,p as pr}from"./add-base-path-CP-wUZSB.js";import{a as mr}from"./image-context-B4PdNff0.js";import{r as gr}from"./index-CUneVrWE.js";import{u as vr}from"./index-yHYUIvBd.js";import{A as br}from"./index-3Yb4qiDF.js";import{P as hr}from"./index-3yJYpOTO.js";import{R as yr}from"./index-CQ-zA9ic.js";import{B as oe}from"./box-BDoFiJcT.js";import{C as te}from"./container-DUbPfsQN.js";import{V as ve}from"./v-stack-DLbVHDKJ.js";import{T as X}from"./text-ddCD_fM-.js";import"./button-BzGfOniU.js";import"./attr-C3Jtgmrz.js";import"./spinner-BaqUdWIg.js";import"./index-BRNWFSEf.js";import"./index-BEZemFFB.js";import"./index-DGKHe-6Q.js";import"./create-slot-recipe-context-BILcAqFF.js";import"./index-sN4N5U7s.js";import"./factory-GA1w9YC2.js";import"./index-Bkt13QoG.js";import"./index-CrjboX4Z.js";import"./index-CmCyOxug.js";import"./index-C0w2AICy.js";import"./zod-C0AimxcA.js";import"./index-bOlNTxDG.js";import"./responsive-modal-DLT1hDTr.js";import"./index-DaYnusiY.js";import"./icon-button-CZw3PtnZ.js";import"./render-strategy-CtmThjeo.js";import"./index-7Dro8rd9.js";import"./simple-grid-DKuTOOEA.js";import"./grid-W1xKhCbE.js";import"./types-DwQkBYn-.js";import"./index-_ZCxv-ro.js";import"./card-BfIoSqEc.js";import"./h-stack-Bm4oIVhc.js";const Cr=()=>{const r=Te(Je,"_temp");return Be(r).id},_r=()=>{const r=Te(Je,"app/onlinedraft/user");return{createUser:re.useCallback(async(s,g,v,t)=>{if(!s.trim())throw new Error("グループIDが必要です");if(!g.trim())throw new Error("ユーザー名を入力してください");if(g.length>20)throw new Error("ユーザー名は20文字以内で入力してください");if(!v.trim())throw new Error("アバターを選択してください");if(!t.trim())throw new Error("ユーザーIDが必要です");const i={userId:t,userName:g.trim(),groupId:s.trim(),avatar:v.trim()};try{const C=Be(r,t);await Ke(C,{...i,joinedAt:ge(),updatedAt:ge()})}catch(C){throw C instanceof Error?new Error(`ユーザー作成に失敗しました: ${C.message}`):new Error("ユーザー作成中に予期しないエラーが発生しました")}},[r]),userCollection:r}};var G={exports:{}},$={exports:{}},be;function Ar(){return be||(be=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useIntersection",{enumerable:!0,get:function(){return I}});const s=Se(),g=sr(),v=typeof IntersectionObserver=="function",t=new Map,i=[];function C(b){const l={root:b.root||null,margin:b.rootMargin||""},R=i.find(y=>y.root===l.root&&y.margin===l.margin);let u;if(R&&(u=t.get(R),u))return u;const _=new Map,h=new IntersectionObserver(y=>{y.forEach(c=>{const F=_.get(c.target),A=c.isIntersecting||c.intersectionRatio>0;F&&A&&F(A)})},b);return u={id:l,observer:h,elements:_},i.push(l),t.set(l,u),u}function x(b,l,R){const{id:u,observer:_,elements:h}=C(R);return h.set(b,l),_.observe(b),function(){if(h.delete(b),_.unobserve(b),h.size===0){_.disconnect(),t.delete(u);const c=i.findIndex(F=>F.root===u.root&&F.margin===u.margin);c>-1&&i.splice(c,1)}}}function I(b){let{rootRef:l,rootMargin:R,disabled:u}=b;const _=u||!v,[h,y]=(0,s.useState)(!1),c=(0,s.useRef)(null),F=(0,s.useCallback)(D=>{c.current=D},[]);(0,s.useEffect)(()=>{if(v){if(_||h)return;const D=c.current;if(D&&D.tagName)return x(D,N=>N&&y(N),{root:l==null?void 0:l.current,rootMargin:R})}else if(!h){const D=(0,g.requestIdleCallback)(()=>y(!0));return()=>(0,g.cancelIdleCallback)(D)}},[_,R,l,h,c.current]);const A=(0,s.useCallback)(()=>{y(!1)},[]);return[F,h,A]}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}($,$.exports)),$.exports}var W={exports:{}},he;function Dr(){return he||(he=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getDomainLocale",{enumerable:!0,get:function(){return s}}),ir();function s(g,v,t,i){return!1}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(W,W.exports)),W.exports}var Y={},ye;function kr(){return ye||(ye=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return e}});let e=s=>{}}(Y)),Y}var Ce;function Lr(){return Ce||(Ce=1,function(r,e){"use client";Object.defineProperty(e,"__esModule",{value:!0});function s(n,k){for(var p in k)Object.defineProperty(n,p,{enumerable:!0,get:k[p]})}s(e,{default:function(){return He},useLinkStatus:function(){return Ve}});const g=nr(),v=ar(),t=g._(Se()),i=ur(),C=lr(),x=cr(),I=dr(),b=fr(),l=mr(),R=Ar(),u=Dr(),_=pr(),h=gr();kr();const y=new Set;function c(n,k,p,m){if(!(typeof window>"u")&&(0,C.isLocalURL)(k)){if(!m.bypassPrefetchedCheck){const j=typeof m.locale<"u"?m.locale:"locale"in n?n.locale:void 0,w=k+"%"+p+"%"+j;if(y.has(w))return;y.add(w)}n.prefetch(k,p,m).catch(j=>{})}}function F(n){const p=n.currentTarget.getAttribute("target");return p&&p!=="_self"||n.metaKey||n.ctrlKey||n.shiftKey||n.altKey||n.nativeEvent&&n.nativeEvent.which===2}function A(n,k,p,m,j,w,V,K,H){const{nodeName:Q}=n.currentTarget;if(Q.toUpperCase()==="A"&&F(n)||n.currentTarget.hasAttribute("download"))return;if(!(0,C.isLocalURL)(p)){j&&(n.preventDefault(),location.replace(p));return}n.preventDefault(),(()=>{if(H){let T=!1;if(H({preventDefault:()=>{T=!0}}),T)return}const E=V??!0;"beforePopState"in k?k[j?"replace":"push"](p,m,{shallow:w,locale:K,scroll:E}):k[j?"replace":"push"](m||p,{scroll:E})})()}function D(n){return typeof n=="string"?n:(0,x.formatUrl)(n)}const P=t.default.forwardRef(function(k,p){let m;const{href:j,as:w,children:V,prefetch:K=null,passHref:H,replace:Q,shallow:ne,scroll:ae,locale:E,onClick:T,onNavigate:Ze,onMouseEnter:se,onTouchStart:ie,legacyBehavior:M=!1,...Ge}=k;m=V,M&&(typeof m=="string"||typeof m=="number")&&(m=(0,v.jsx)("a",{children:m}));const o=t.default.useContext(l.RouterContext),ue=K!==!1,{href:q,as:L}=t.default.useMemo(()=>{if(!o){const me=D(j);return{href:me,as:w?D(w):me}}const[f,U]=(0,i.resolveHref)(o,j,!0);return{href:f,as:w?(0,i.resolveHref)(o,w):U||f}},[o,j,w]),le=t.default.useRef(q),ce=t.default.useRef(L);let d;M&&(d=t.default.Children.only(m));const $e=M?d&&typeof d=="object"&&d.ref:p,[de,fe,pe]=(0,R.useIntersection)({rootMargin:"200px"}),We=t.default.useCallback(f=>{(ce.current!==L||le.current!==q)&&(pe(),ce.current=L,le.current=q),de(f)},[L,q,pe,de]),ze=(0,h.useMergedRef)(We,$e);t.default.useEffect(()=>{o&&(!fe||!ue||c(o,q,L,{locale:E}))},[L,q,fe,E,ue,o==null?void 0:o.locale,o]);const Z={ref:ze,onClick(f){!M&&typeof T=="function"&&T(f),M&&d.props&&typeof d.props.onClick=="function"&&d.props.onClick(f),o&&(f.defaultPrevented||A(f,o,q,L,Q,ne,ae,E,Ze))},onMouseEnter(f){!M&&typeof se=="function"&&se(f),M&&d.props&&typeof d.props.onMouseEnter=="function"&&d.props.onMouseEnter(f),o&&c(o,q,L,{locale:E,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(U){!M&&typeof ie=="function"&&ie(U),M&&d.props&&typeof d.props.onTouchStart=="function"&&d.props.onTouchStart(U),o&&c(o,q,L,{locale:E,priority:!0,bypassPrefetchedCheck:!0})}};if((0,I.isAbsoluteUrl)(L))Z.href=L;else if(!M||H||d.type==="a"&&!("href"in d.props)){const f=typeof E<"u"?E:o==null?void 0:o.locale,U=(o==null?void 0:o.isLocaleDomain)&&(0,u.getDomainLocale)(L,f,o==null?void 0:o.locales,o==null?void 0:o.domainLocales);Z.href=U||(0,_.addBasePath)((0,b.addLocale)(L,f,o==null?void 0:o.defaultLocale))}return M?t.default.cloneElement(d,Z):(0,v.jsx)("a",{...Ge,...Z,children:m})}),N=(0,t.createContext)({pending:!1}),Ve=()=>(0,t.useContext)(N),He=P;(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(G,G.exports)),G.exports}var ee,_e;function Rr(){return _e||(_e=1,ee=Lr()),ee}var Fr=Rr();const Mr=tr(Fr),z=({group:r,users:e,roomUrl:s,isAvatarModalOpen:g,usedAvatars:v,onJoinClick:t,onUserSelect:i,onAvatarModalClose:C,onJoinConfirm:x})=>r?a.jsxs(oe,{bg:"gray.50",minH:"100vh",py:[4,8],children:[a.jsx(te,{maxW:"container.lg",children:a.jsxs(ve,{gap:6,children:[a.jsx(X,{fontSize:["xl","2xl"],fontWeight:"bold",color:"gray.800",children:"ドラフトルーム"}),a.jsx(yr,{group:r,roomUrl:s}),a.jsx(hr,{users:e||[],onJoinClick:t,onUserSelect:i}),a.jsx(Mr,{href:"/",children:a.jsx(Qe,{variant:"outline",size:"sm",children:"ルームを退出"})})]})}),a.jsx(br,{isOpen:g,onClose:C,onConfirm:x,usedAvatars:v})]}):a.jsx(oe,{bg:"gray.50",minH:"100vh",py:[4,8],children:a.jsx(te,{maxW:"container.lg",children:a.jsxs(ve,{gap:6,children:[a.jsx(X,{fontSize:["xl","2xl"],fontWeight:"bold",color:"red.600",children:"ルームが見つかりません"}),a.jsx(X,{color:"gray.600",children:"指定されたルームが存在しないか、削除されている可能性があります。"})]})})}),Ae=({groupId:r})=>{const{isAuthenticated:e,signInAnonymous:s,loading:g}=er(),{group:v,loading:t}=rr(r),{users:i,loading:C}=or(r),{createUser:x}=_r(),I=vr(),[b,l]=re.useState(!1),{errorToast:R,successToast:u}=Ye();re.useEffect(()=>{},[e,g,s,R]);const _=`https://example.com/lobby/${r}`,h=t||C||!1,y=(i==null?void 0:i.map(A=>A.avatar))||[],c=async A=>{const D=Cr();try{await x(r,A.name,A.avatar,D),sessionStorage.setItem("onlinedraft_user_id",D),I.push(`/draft/${r}`),u("ドラフトに参加しました！")}catch(P){console.error("参加エラー:",P),R(P instanceof Error?P.message:"参加に失敗しました")}},F=A=>{sessionStorage.setItem("onlinedraft_user_id",A),I.push(`/draft/${r}`),u("ドラフトに参加しました！")};return h||!e||g||!v?a.jsx(oe,{bg:"gray.50",minH:"100vh",py:[4,8],children:a.jsx(te,{maxW:"container.lg",children:a.jsx(Xe,{message:"ローディング中..."})})}):a.jsx(z,{group:v,users:i,roomUrl:_,isAvatarModalOpen:b,usedAvatars:y,onJoinClick:()=>l(!0),onUserSelect:F,onAvatarModalClose:()=>l(!1),onJoinConfirm:c})};try{z.displayName="LobbyPageInner",z.__docgenInfo={description:`ロビー画面Innerコンポーネント（Presenter）
UI描画のみを担当、propsでデータとハンドラーを受け取る
Firebaseやビジネスロジックには依存しない純粋なUIコンポーネント`,displayName:"LobbyPageInner",props:{group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"GroupDataType | null"}},users:{defaultValue:null,description:"",name:"users",required:!0,type:{name:"UserDataType[] | null"}},roomUrl:{defaultValue:null,description:"",name:"roomUrl",required:!0,type:{name:"string"}},isAvatarModalOpen:{defaultValue:null,description:"",name:"isAvatarModalOpen",required:!0,type:{name:"boolean"}},usedAvatars:{defaultValue:null,description:"",name:"usedAvatars",required:!0,type:{name:"string[]"}},onJoinClick:{defaultValue:null,description:"",name:"onJoinClick",required:!0,type:{name:"() => void"}},onUserSelect:{defaultValue:null,description:"",name:"onUserSelect",required:!0,type:{name:"(userId: string) => void"}},onAvatarModalClose:{defaultValue:null,description:"",name:"onAvatarModalClose",required:!0,type:{name:"() => void"}},onJoinConfirm:{defaultValue:null,description:"",name:"onJoinConfirm",required:!0,type:{name:"(userData: { name: string; avatar: string; }) => void"}}}}}catch{}try{Ae.displayName="LobbyPage",Ae.__docgenInfo={description:`ロビー画面コンポーネント（Container）
ロジック・データ取得・認証のみを担当
LobbyPageInnerにpropsを渡すのみ`,displayName:"LobbyPage",props:{groupId:{defaultValue:null,description:"",name:"groupId",required:!0,type:{name:"string"}}}}}catch{}const Lo={title:"features/lobby/LobbyPage",component:z,parameters:{layout:"fullscreen"}},Ne={groupName:"2024年プロ野球ドラフト",createdAt:new Date("2024-06-17T10:00:00Z"),updatedAt:new Date("2024-06-17T10:00:00Z"),status:"waiting",maxParticipants:8},jr=[{userId:"user1",userName:"たろう",groupId:"group123",avatar:"1",joinedAt:O.fromDate(new Date("2024-06-17T10:00:00Z")),updatedAt:O.fromDate(new Date("2024-06-17T10:00:00Z")),isActive:!0},{userId:"user2",userName:"はなこ",groupId:"group123",avatar:"2",joinedAt:O.fromDate(new Date("2024-06-17T10:05:00Z")),updatedAt:O.fromDate(new Date("2024-06-17T10:05:00Z")),isActive:!0},{userId:"user3",userName:"じろう",groupId:"group123",avatar:"3",joinedAt:O.fromDate(new Date("2024-06-17T10:10:00Z")),updatedAt:O.fromDate(new Date("2024-06-17T10:10:00Z")),isActive:!1}],B={args:{group:Ne,users:jr,roomUrl:"https://onlinedraft.com/lobby/abc123",loading:!1,isAvatarModalOpen:!1,usedAvatars:["1","2","3"],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}},J={args:{group:null,users:null,roomUrl:"",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>{},onLeaveRoom:()=>{},onAvatarModalClose:()=>{},onJoinConfirm:()=>{}}},S={args:{group:{...Ne,groupName:"新規作成ルーム"},users:[],roomUrl:"https://onlinedraft.com/lobby/newroom123",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}};var De,ke,Le,Re,Fe;B.parameters={...B.parameters,docs:{...(De=B.parameters)==null?void 0:De.docs,source:{originalSource:`{
  args: {
    group: mockGroup,
    users: mockUsers,
    roomUrl: 'https://onlinedraft.com/lobby/abc123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: ['1', '2', '3'],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Le=(ke=B.parameters)==null?void 0:ke.docs)==null?void 0:Le.source},description:{story:`基本のロビーページ表示（3人参加）
Firebaseロジックを含まない純粋なUIテスト`,...(Fe=(Re=B.parameters)==null?void 0:Re.docs)==null?void 0:Fe.description}}};var Me,je,we,Ee,qe;J.parameters={...J.parameters,docs:{...(Me=J.parameters)==null?void 0:Me.docs,source:{originalSource:`{
  args: {
    group: null,
    users: null,
    roomUrl: '',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => {},
    onLeaveRoom: () => {},
    onAvatarModalClose: () => {},
    onJoinConfirm: () => {}
  }
}`,...(we=(je=J.parameters)==null?void 0:je.docs)==null?void 0:we.source},description:{story:"ルームが見つからない状態",...(qe=(Ee=J.parameters)==null?void 0:Ee.docs)==null?void 0:qe.description}}};var xe,Ie,Pe,Ue,Oe;S.parameters={...S.parameters,docs:{...(xe=S.parameters)==null?void 0:xe.docs,source:{originalSource:`{
  args: {
    group: {
      ...mockGroup,
      groupName: '新規作成ルーム'
    },
    users: [],
    roomUrl: 'https://onlinedraft.com/lobby/newroom123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Pe=(Ie=S.parameters)==null?void 0:Ie.docs)==null?void 0:Pe.source},description:{story:"参加者なし（新規ルーム）",...(Oe=(Ue=S.parameters)==null?void 0:Ue.docs)==null?void 0:Oe.description}}};const Ro=["Basic","RoomNotFound","EmptyRoom"];export{B as Basic,S as EmptyRoom,J as RoomNotFound,Ro as __namedExportsOrder,Lo as default};
