import{j as e}from"./stack-B25eOQea.js";import{I as T}from"./index-Bxr0EmBi.js";import{R as v}from"./responsive-modal-Y5TxC2k_.js";import{u as H}from"./useChat-D_x93NB9.js";import{d as q}from"./common-qjYFItnW.js";import{d as G,s as O}from"./index.esm2017-rypblU8U.js";import{r as V}from"./index-BXymfbzT.js";import{u as U,a as W}from"./zod-C0AimxcA.js";import{u as X}from"./useModal-IzikcFvB.js";import{g as Y,u as J,c as K,s as P,b as Q}from"./states-Bd1A8IJM.js";import{V as x}from"./v-stack-DLbVHDKJ.js";import{B as Z}from"./box-BDoFiJcT.js";import{H as z}from"./h-stack-Bm4oIVhc.js";import{T as l}from"./text-ddCD_fM-.js";import{u as h}from"./react-BSHoCbAh.js";import{ar as ee,aF as D}from"./types-JQgdQoTs.js";const te=()=>({upsertSelection:V.useCallback(async n=>{const{groupId:i,userId:o,item:a,comment:t,round:m,currentSelections:s}=n;try{const d=Math.floor(Math.random()*1e6),S=G(q,"app/onlinedraft/selection",o),y=s.filter(u=>u.userId===o).filter(u=>u.round!==m),I={item:a,comment:t,round:m,randomNumber:d},p=[...y.map(u=>({item:u.item,comment:u.comment,round:u.round,randomNumber:u.randomNumber})),I];return await O(S,{userId:o,selection:p}),i}catch(d){throw console.error("選択データのupsertに失敗しました:",d),d}},[])}),j=50,E=20,M=100,oe=(r,n,i,o)=>{if(!r||n===null||n===void 0)return{modalTitle:"ドラフト指名",defaultItem:"",defaultComment:"",isEditMode:!1,editContext:void 0};const a=o.find(s=>s.id===r),t=i.find(s=>s.userId===r&&s.round===n),m=!!t;return{modalTitle:m?"ドラフト指名を編集":"ドラフト指名",defaultItem:(t==null?void 0:t.item)||"",defaultComment:(t==null?void 0:t.comment)||"",isEditMode:m,editContext:m&&a?{round:n,playerName:a.name}:void 0}},re=(r,n,i,o)=>ee({item:D().min(1,"アイテム名を入力してください").max(j,`${j}文字以内で入力してください`).refine(a=>r&&o&&a.toLowerCase()===o.toLowerCase()?!0:!n.filter(s=>s.round<i).some(s=>s.item.toLowerCase()===a.toLowerCase()),"このアイテムは過去のラウンドで既に選択されています"),comment:D().max(r?E:M,r?`${E}文字以内で入力してください`:`${M}文字以内で入力してください`).default("")}),L=X,R=({isOpen:r,onClose:n,userId:i,round:o})=>{const a=V.useId(),t=h(P),m=h(J),s=h(K),d=h(Q),{round:S}=h(Y),C=m.find(({id:g})=>g===s),{sendSystemMessage:y}=H(),{modalTitle:I,defaultItem:p,defaultComment:F,isEditMode:u,editContext:c}=oe(i,o,t,m),{upsertSelection:$}=te(),{register:A,handleSubmit:B,formState:{errors:f,isSubmitting:b},reset:N}=U({resolver:W(re(u,t,S,p)),mode:"onChange",defaultValues:{item:p,comment:F}}),k=async g=>{try{if(await $({groupId:d,userId:i,item:g.item,comment:g.comment,round:o,currentSelections:t}),S!==o&&p!==g.item){const _=C==null?void 0:C.name;await y(d,`[${o}R-${c==null?void 0:c.playerName}] ${p}→${g.item} by ${_}`)}n(),N()}catch(_){console.error("指名エラー:",_)}},w=()=>{b||(n(),N())};return e.jsx(v,{isOpen:r,onClose:w,title:I,actions:{cancel:{text:"キャンセル",onClick:w},submit:{text:"決定",type:"submit",form:a,loading:b,disabled:b}},children:e.jsxs(x,{as:"form",id:a,onSubmit:B(k),gap:4,w:"full",children:[c&&e.jsx(Z,{w:"full",p:3,bg:"gray.50",borderRadius:"md",children:e.jsxs(x,{gap:2,align:"start",children:[e.jsxs(z,{children:[e.jsx(l,{fontSize:"xs",color:"gray.600",children:"ラウンド:"}),e.jsxs(l,{fontSize:"sm",fontWeight:"bold",children:["Round ",c.round]})]}),e.jsxs(z,{children:[e.jsx(l,{fontSize:"xs",color:"gray.600",children:"プレイヤー:"}),e.jsx(l,{fontSize:"sm",fontWeight:"bold",children:c.playerName})]})]})}),e.jsxs(x,{gap:2,align:"start",w:"full",children:[e.jsx(l,{fontSize:"sm",fontWeight:"bold",color:"gray.700",children:"ドラフト指名"}),e.jsx(T,{...A("item"),placeholder:"指名を入力してください",maxLength:j,size:"lg",error:!!f.item}),f.item&&e.jsx(l,{fontSize:"sm",color:"red.500",children:f.item.message})]}),e.jsxs(x,{gap:2,align:"start",w:"full",children:[e.jsx(l,{fontSize:"sm",fontWeight:"bold",color:"gray.700",children:"コメント（任意）"}),e.jsx(T,{...A("comment"),placeholder:c?"コメントを入力してください":"この指名についてのコメント...",maxLength:c?E:M,size:"lg",error:!!f.comment}),f.comment&&e.jsx(l,{fontSize:"sm",color:"red.500",children:f.comment.message})]})]})})};try{L.displayName="useItemSelectModal",L.__docgenInfo={description:`アイテム選択モーダル用hooks
汎用useModalを利用した軽量実装`,displayName:"useItemSelectModal",props:{}}}catch{}try{R.displayName="ItemSelectModal",R.__docgenInfo={description:`アイテム選択モーダルコンポーネント
react-hook-form + zodバリデーション使用`,displayName:"ItemSelectModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},userId:{defaultValue:null,description:"",name:"userId",required:!0,type:{name:"string"}},round:{defaultValue:null,description:"",name:"round",required:!0,type:{name:"number"}}}}}catch{}export{R as I,L as u};
