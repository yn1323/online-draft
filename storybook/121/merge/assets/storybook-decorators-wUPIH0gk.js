import{j as N}from"./create-recipe-context-LbQq3bM7.js";import{f as Ce}from"./index-CVTRJrKK.js";import{r as R,R as pe}from"./index-BXymfbzT.js";const k=e=>({uid:"mock-user-id",isAnonymous:!0,displayName:null,email:null,phoneNumber:null,photoURL:null,providerId:"firebase",refreshToken:"mock-refresh-token",tenantId:null,emailVerified:!1,metadata:{creationTime:void 0,lastSignInTime:void 0},providerData:[],delete:async()=>{},getIdToken:async()=>"mock-token",getIdTokenResult:async()=>({}),reload:async()=>{},toJSON:()=>({}),...e});k(),k({isAnonymous:!1,email:"test@example.com",displayName:"テストユーザー",emailVerified:!0});const P={},te=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,re=e=>"init"in e,q=e=>!!e.write,ne=e=>"v"in e||"e"in e,j=e=>{if("e"in e)throw e.e;if((P?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},V=new WeakMap,oe=e=>{var t;return O(e)&&!!((t=V.get(e))!=null&&t[0])},Re=e=>{const t=V.get(e);t!=null&&t[0]&&(t[0]=!1,t[1].forEach(r=>r()))},he=(e,t)=>{let r=V.get(e);if(!r){r=[!0,new Set],V.set(e,r);const o=()=>{r[0]=!1};e.then(o,o)}r[1].add(t)},O=e=>typeof(e==null?void 0:e.then)=="function",ye=(e,t,r)=>{r.p.has(e)||(r.p.add(e),t.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},$=(e,t,r)=>{const o=r(e),a="v"in o,d=o.v;if(O(t))for(const f of o.d.keys())ye(e,t,r(f));o.v=t,delete o.e,(!a||!Object.is(d,o.v))&&(++o.n,O(d)&&Re(d))},se=(e,t,r)=>{var o;const a=new Set;for(const d of((o=r.get(e))==null?void 0:o.t)||[])r.has(d)&&a.add(d);for(const d of t.p)a.add(d);return a},me=()=>{const e=new Set,t=()=>{e.forEach(r=>r())};return t.add=r=>(e.add(r),()=>{e.delete(r)}),t},G=()=>{const e={},t=new WeakMap,r=o=>{var a,d;(a=t.get(e))==null||a.forEach(f=>f(o)),(d=t.get(o))==null||d.forEach(f=>f())};return r.add=(o,a)=>{const d=o||e,f=(t.has(d)?t:t.set(d,new Set)).get(d);return f.add(a),()=>{f==null||f.delete(a),f.size||t.delete(d)}},r},Fe=e=>(e.c||(e.c=G()),e.m||(e.m=G()),e.u||(e.u=G()),e.f||(e.f=me()),e),Ne=Symbol(),ke=(e=new WeakMap,t=new WeakMap,r=new WeakMap,o=new Set,a=new Set,d=new Set,f={},g=(p,...A)=>p.read(...A),S=(p,...A)=>p.write(...A),_=(p,A)=>{var b;return(b=p.unstable_onInit)==null?void 0:b.call(p,A)},h=(p,A)=>{var b;return(b=p.onMount)==null?void 0:b.call(p,A)},...v)=>{const p=v[0]||(n=>{if((P?"production":void 0)!=="production"&&!n)throw new Error("Atom is undefined or null");let l=e.get(n);return l||(l={d:new Map,p:new Set,n:0},e.set(n,l),_==null||_(n,z)),l}),A=v[1]||(()=>{const n=[],l=c=>{try{c()}catch(u){n.push(u)}};do{f.f&&l(f.f);const c=new Set,u=c.add.bind(c);o.forEach(s=>{var i;return(i=t.get(s))==null?void 0:i.l.forEach(u)}),o.clear(),d.forEach(u),d.clear(),a.forEach(u),a.clear(),c.forEach(l),o.size&&b()}while(o.size||d.size||a.size);if(n.length)throw new AggregateError(n)}),b=v[2]||(()=>{const n=[],l=new WeakSet,c=new WeakSet,u=Array.from(o);for(;u.length;){const s=u[u.length-1],i=p(s);if(c.has(s)){u.pop();continue}if(l.has(s)){if(r.get(s)===i.n)n.push([s,i]);else if((P?"production":void 0)!=="production"&&r.has(s))throw new Error("[Bug] invalidated atom exists");c.add(s),u.pop();continue}l.add(s);for(const w of se(s,i,t))l.has(w)||u.push(w)}for(let s=n.length-1;s>=0;--s){const[i,w]=n[s];let E=!1;for(const F of w.d.keys())if(F!==i&&o.has(F)){E=!0;break}E&&(m(i),T(i)),r.delete(i)}}),m=v[3]||(n=>{var l;const c=p(n);if(ne(c)&&(t.has(n)&&r.get(n)!==c.n||Array.from(c.d).every(([y,M])=>m(y).n===M)))return c;c.d.clear();let u=!0;const s=()=>{t.has(n)&&(T(n),b(),A())},i=y=>{var M;if(te(n,y)){const ee=p(y);if(!ne(ee))if(re(y))$(y,y.init,p);else throw new Error("no atom init");return j(ee)}const J=m(y);try{return j(J)}finally{c.d.set(y,J.n),oe(c.v)&&ye(n,c.v,J),(M=t.get(y))==null||M.t.add(n),u||s()}};let w,E;const F={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(P?"production":void 0)!=="production"&&!q(n)&&console.warn("setSelf function cannot be used with read-only atom"),!E&&q(n)&&(E=(...y)=>{if((P?"production":void 0)!=="production"&&u&&console.warn("setSelf function cannot be called in sync"),!u)try{return U(n,...y)}finally{b(),A()}}),E}},L=c.n;try{const y=g(n,i,F);return $(n,y,p),O(y)&&(he(y,()=>w==null?void 0:w.abort()),y.then(s,s)),c}catch(y){return delete c.v,c.e=y,++c.n,c}finally{u=!1,L!==c.n&&r.get(n)===L&&(r.set(n,c.n),o.add(n),(l=f.c)==null||l.call(f,n))}}),W=v[4]||(n=>{const l=[n];for(;l.length;){const c=l.pop(),u=p(c);for(const s of se(c,u,t)){const i=p(s);r.set(s,i.n),l.push(s)}}}),U=v[5]||((n,...l)=>{let c=!0;const u=i=>j(m(i)),s=(i,...w)=>{var E;const F=p(i);try{if(te(n,i)){if(!re(i))throw new Error("atom not writable");const L=F.n,y=w[0];$(i,y,p),T(i),L!==F.n&&(o.add(i),(E=f.c)==null||E.call(f,i),W(i));return}else return U(i,...w)}finally{c||(b(),A())}};try{return S(n,u,s,...l)}finally{c=!1}}),T=v[6]||(n=>{var l;const c=p(n),u=t.get(n);if(u&&!oe(c.v)){for(const[s,i]of c.d)if(!u.d.has(s)){const w=p(s);x(s).t.add(n),u.d.add(s),i!==w.n&&(o.add(s),(l=f.c)==null||l.call(f,s),W(s))}for(const s of u.d||[])if(!c.d.has(s)){u.d.delete(s);const i=B(s);i==null||i.t.delete(n)}}}),x=v[7]||(n=>{var l;const c=p(n);let u=t.get(n);if(!u){m(n);for(const s of c.d.keys())x(s).t.add(n);if(u={l:new Set,d:new Set(c.d.keys()),t:new Set},t.set(n,u),(l=f.m)==null||l.call(f,n),q(n)){const s=()=>{let i=!0;const w=(...E)=>{try{return U(n,...E)}finally{i||(b(),A())}};try{const E=h(n,w);E&&(u.u=()=>{i=!0;try{E()}finally{i=!1}})}finally{i=!1}};a.add(s)}}return u}),B=v[8]||(n=>{var l;const c=p(n);let u=t.get(n);if(u&&!u.l.size&&!Array.from(u.t).some(s=>{var i;return(i=t.get(s))==null?void 0:i.d.has(n)})){u.u&&d.add(u.u),u=void 0,t.delete(n),(l=f.u)==null||l.call(f,n);for(const s of c.d.keys()){const i=B(s);i==null||i.t.delete(n)}return}return u}),be=[e,t,r,o,a,d,f,g,S,_,h,p,A,b,m,W,U,T,x,B],z={get:n=>j(m(n)),set:(n,...l)=>{try{return U(n,...l)}finally{b(),A()}},sub:(n,l)=>{const u=x(n).l;return u.add(l),A(),()=>{u.delete(l),B(n),A()}}};return Object.defineProperty(z,Ne,{value:be}),z},ge=ke,De=Fe,ue=he,Z={};let Ue=0;function C(e,t){const r=`atom${++Ue}`,o={toString(){return(Z?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?o.read=e:(o.init=e,o.read=Ie,o.write=Pe),t&&(o.write=t),o}function Ie(e){return e(this)}function Pe(e,t,r){return t(this,typeof r=="function"?r(e(this)):r)}const Te=()=>{let e=0;const t=De({}),r=new WeakMap,o=new WeakMap,a=ge(r,o,void 0,void 0,void 0,void 0,t,void 0,(g,S,_,...h)=>e?_(g,...h):g.write(S,_,...h)),d=new Set;return t.m.add(void 0,g=>{d.add(g);const S=r.get(g);S.m=o.get(g)}),t.u.add(void 0,g=>{d.delete(g);const S=r.get(g);delete S.m}),Object.assign(a,{dev4_get_internal_weak_map:()=>(console.log("Deprecated: Use devstore from the devtools library"),r),dev4_get_mounted_atoms:()=>d,dev4_restore_atoms:g=>{const S={read:()=>null,write:(_,h)=>{++e;try{for(const[v,p]of g)"init"in v&&h(v,p)}finally{--e}}};a.set(S)}})};function H(){return(Z?"production":void 0)!=="production"?Te():ge()}let I;function xe(){return I||(I=H(),(Z?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=I),globalThis.__JOTAI_DEFAULT_STORE__!==I&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),I}const Be={},ve=R.createContext(void 0);function Se(e){return R.useContext(ve)||xe()}function we({children:e,store:t}){const r=R.useRef(void 0);return!t&&!r.current&&(r.current=H()),R.createElement(ve.Provider,{value:t||r.current},e)}const Y=e=>typeof(e==null?void 0:e.then)=="function",Q=e=>{e.status||(e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}))},Le=pe.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Q(e),e)}),K=new WeakMap,ie=(e,t)=>{let r=K.get(e);return r||(r=new Promise((o,a)=>{let d=e;const f=_=>h=>{d===_&&o(h)},g=_=>h=>{d===_&&a(h)},S=()=>{try{const _=t();Y(_)?(K.set(_,r),d=_,_.then(f(_),g(_)),ue(_,S)):o(_)}catch(_){a(_)}};e.then(f(e),g(e)),ue(e,S)}),K.set(e,r)),r};function Me(e,t){const{delay:r,unstable_promiseStatus:o=!pe.use}={},a=Se(),[[d,f,g],S]=R.useReducer(h=>{const v=a.get(e);return Object.is(h[0],v)&&h[1]===a&&h[2]===e?h:[v,a,e]},void 0,()=>[a.get(e),a,e]);let _=d;if((f!==a||g!==e)&&(S(),_=a.get(e)),R.useEffect(()=>{const h=a.sub(e,()=>{if(o)try{const v=a.get(e);Y(v)&&Q(ie(v,()=>a.get(e)))}catch{}if(typeof r=="number"){setTimeout(S,r);return}S()});return S(),h},[a,e,r,o]),R.useDebugValue(_),Y(_)){const h=ie(_,()=>a.get(e));return o&&Q(h),Le(h)}return _}function je(e,t){const r=Se();return R.useCallback((...a)=>{if((Be?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return r.set(e,...a)},[r,e])}function Qe(e,t){return[Me(e),je(e)]}const Ae={CURRENT_USER:"onlinedraft_current_user",RECENT_GROUPS:"onlinedraft_recent_groups"},Ve=e=>{try{const t={...e,timestamp:Date.now()};localStorage.setItem(Ae.CURRENT_USER,JSON.stringify(t)),console.log("💾 ユーザー情報をLocalStorageに保存:",t)}catch(t){console.error("❌ ユーザー情報保存エラー:",t)}},Oe=()=>{try{localStorage.removeItem(Ae.CURRENT_USER),console.log("🗑️ ユーザー情報をクリア")}catch(e){console.error("❌ ユーザー情報クリアエラー:",e)}},We=C(null),ze=C(!0),Xe=C(null),Je=C({uid:""}),qe=C(null);C(null,(e,t,r)=>{t(qe,r),r?Ve({userId:r.userId||"",userName:r.userName,avatar:r.avatar}):Oe()});const Ze=C([]),He=C(!1),et=C(null),Ee=e=>{const t=H(),r=(e==null?void 0:e.user)??k(),o=(e==null?void 0:e.loading)??!1;return t.set(We,r),t.set(ze,o),t.set(Je,{uid:(r==null?void 0:r.uid)??"mock-user-id"}),t},$e={push:e=>(console.log("📚 [Storybook] Router.push called:",e),Promise.resolve(!0)),replace:e=>(console.log("📚 [Storybook] Router.replace called:",e),Promise.resolve(!0)),refresh:()=>{console.log("📚 [Storybook] Router.refresh called")},back:()=>{console.log("📚 [Storybook] Router.back called")},forward:()=>{console.log("📚 [Storybook] Router.forward called")},prefetch:e=>(console.log("📚 [Storybook] Router.prefetch called:",e),Promise.resolve())},X=({children:e})=>N.jsx(Ce.AppRouterContext.Provider,{value:$e,children:e}),ce=e=>N.jsx(X,{children:N.jsx(e,{})});try{X.displayName="MockAppRouterProvider",X.__docgenInfo={description:"App Router コンテキストプロバイダー (Storybook用)",displayName:"MockAppRouterProvider",props:{}}}catch{}try{ce.displayName="withMockAppRouter",ce.__docgenInfo={description:"Storybook用のApp Routerデコレーター",displayName:"withMockAppRouter",props:{}}}catch{}const D=e=>t=>{const r=Ee(e);return N.jsx(we,{store:r,children:N.jsx(t,{})})},ae=D({user:k(),loading:!1}),le=D({user:null,loading:!1}),de=D({user:null,loading:!0}),fe=e=>D({user:k(e),loading:!1}),_e=e=>t=>{const r=Ee({user:(e==null?void 0:e.firebaseAuthenticated)!==!1?k():null,loading:!1});return N.jsx(we,{store:r,children:N.jsx(t,{})})};try{D.displayName="withMockAuth",D.__docgenInfo={description:"認証状態付きJotaiプロバイダーデコレーター",displayName:"withMockAuth",props:{user:{defaultValue:null,description:"",name:"user",required:!1,type:{name:"User | null"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}}}}}catch{}try{ae.displayName="withAuthenticatedUser",ae.__docgenInfo={description:"認証済みユーザー用デコレーター",displayName:"withAuthenticatedUser",props:{}}}catch{}try{le.displayName="withUnauthenticatedUser",le.__docgenInfo={description:"未認証ユーザー用デコレーター",displayName:"withUnauthenticatedUser",props:{}}}catch{}try{de.displayName="withAuthLoading",de.__docgenInfo={description:"認証ローディング中用デコレーター",displayName:"withAuthLoading",props:{}}}catch{}try{fe.displayName="withCustomUser",fe.__docgenInfo={description:"カスタムユーザー用デコレーター作成",displayName:"withCustomUser",props:{}}}catch{}try{_e.displayName="withLobbyMock",_e.__docgenInfo={description:`LobbyPage用のモックデコレーター
Firebase認証とSessionStorageの両方をモック`,displayName:"withLobbyMock",props:{sessionUser:{defaultValue:null,description:"",name:"sessionUser",required:!1,type:{name:"{ id: string; name: string; groupId: string; } | null"}},groupExists:{defaultValue:null,description:"",name:"groupExists",required:!1,type:{name:"boolean"}},firebaseAuthenticated:{defaultValue:null,description:"",name:"firebaseAuthenticated",required:!1,type:{name:"boolean"}}}}}catch{}export{We as a,ze as b,Xe as c,je as d,et as e,He as f,Ze as g,qe as h,_e as i,Qe as u,ce as w};
