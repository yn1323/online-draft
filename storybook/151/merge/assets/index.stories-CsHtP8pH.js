import{c as se,d as ie,o as Ve,q as Xe,w as ye,s as Ye,a as Ce,T}from"./index.esm2017-CJ8tNU3o.js";import{j as c}from"./stack-BPGBxmP7.js";import{B as er}from"./index-C8k1nbEW.js";import{L as rr}from"./index-Bvw4ip2W.js";import{u as or}from"./toaster-MrWoCIy2.js";import{d as X,u as tr}from"./useFirebaseAuth-gBhWBdCb.js";import{r as w,b as He,g as nr}from"./index-BXymfbzT.js";import{a as ar}from"./_interop_require_wildcard-BpaVepTj.js";import{r as sr}from"./jsx-runtime-Bw5QeaCk.js";import{r as ir,w as ur,q as lr,s as cr,n as dr,b as fr,o as pr,p as mr}from"./add-base-path-BHJaKYpX.js";import{a as gr}from"./image-context-B4PdNff0.js";import{r as vr}from"./index-DsE64Tri.js";import{u as br}from"./index-BZxxqrwi.js";import{A as hr}from"./index-DNuV7iBM.js";import{P as yr}from"./index-Bg2BrlRB.js";import{R as Cr}from"./index-CkzwFmqV.js";import{B as ne}from"./box-BF69sWHg.js";import{C as ae}from"./container-BeF7NZEH.js";import{V as _e}from"./v-stack-Dfms-mlT.js";import{T as re}from"./text-CvVCgmJx.js";import"./button-DJPprnzD.js";import"./attr-C3Jtgmrz.js";import"./spinner-BfFBc7wa.js";import"./index-BRNWFSEf.js";import"./index-RgLjKqdB.js";import"./index-DGKHe-6Q.js";import"./create-slot-recipe-context-BnxH4US7.js";import"./index-mWDuOQRc.js";import"./factory--2BDjF06.js";import"./index-Dcv8hpMz.js";import"./index-CrjboX4Z.js";import"./index-CQFDddx8.js";import"./index-C0w2AICy.js";import"./index-DPjlD5zd.js";import"./responsive-modal-Cm4M_39G.js";import"./index-BbIJ_A6v.js";import"./index-DkeST5JT.js";import"./zod-_4ZtKld0.js";import"./simple-grid-q22kchH4.js";import"./grid-mntVVhnA.js";import"./types-DwQkBYn-.js";import"./index-BSDhu79X.js";import"./card-DlhQdIZJ.js";import"./h-stack-CXTYcpFY.js";const _r=()=>{const r=se(X,"_temp");return ie(r).id},Ar=r=>{const[e,n]=w.useState(null),[d,s]=w.useState(!0),[o,i]=w.useState(null);return w.useEffect(()=>{if(!r){n(null),s(!1);return}const u=ie(X,"app/onlinedraft/group",r);return Ve(u,b=>{b.exists()?n(b.data()):n(null),s(!1),i(null)},b=>{i(b),s(!1)})},[r]),{group:e,loading:d,error:o}},Dr=r=>{const[e,n]=w.useState([]),[d,s]=w.useState(!0),[o,i]=w.useState(null);return w.useEffect(()=>{if(!r){n([]),s(!1);return}const u=Xe(se(X,"app/onlinedraft/user"),ye("groupId","==",r),ye("isActive","==",!0));return Ve(u,b=>{const p=b.docs.map(l=>l.data());n(p),s(!1),i(null)},b=>{i(b),s(!1)})},[r]),{users:e,loading:d,error:o}},Lr=()=>{const r=se(X,"app/onlinedraft/user");return{createUser:w.useCallback(async(n,d,s,o)=>{if(!n.trim())throw new Error("グループIDが必要です");if(!d.trim())throw new Error("ユーザー名を入力してください");if(d.length>20)throw new Error("ユーザー名は20文字以内で入力してください");if(!s.trim())throw new Error("アバターを選択してください");if(!o.trim())throw new Error("ユーザーIDが必要です");const i={userId:o,userName:d.trim(),groupId:n.trim(),avatar:s.trim(),isActive:!0};try{const u=ie(r,o);await Ye(u,{...i,joinedAt:Ce(),updatedAt:Ce()})}catch(u){throw u instanceof Error?new Error(`ユーザー作成に失敗しました: ${u.message}`):new Error("ユーザー作成中に予期しないエラーが発生しました")}},[r]),userCollection:r}};var W={exports:{}},z={exports:{}},Ae;function kr(){return Ae||(Ae=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useIntersection",{enumerable:!0,get:function(){return b}});const n=He(),d=ir(),s=typeof IntersectionObserver=="function",o=new Map,i=[];function u(p){const l={root:p.root||null,margin:p.rootMargin||""},R=i.find(A=>A.root===l.root&&A.margin===l.margin);let f;if(R&&(f=o.get(R),f))return f;const h=new Map,y=new IntersectionObserver(A=>{A.forEach(m=>{const E=h.get(m.target),I=m.isIntersecting||m.intersectionRatio>0;E&&I&&E(I)})},p);return f={id:l,observer:y,elements:h},i.push(l),o.set(l,f),f}function x(p,l,R){const{id:f,observer:h,elements:y}=u(R);return y.set(p,l),h.observe(p),function(){if(y.delete(p),h.unobserve(p),y.size===0){h.disconnect(),o.delete(f);const m=i.findIndex(E=>E.root===f.root&&E.margin===f.margin);m>-1&&i.splice(m,1)}}}function b(p){let{rootRef:l,rootMargin:R,disabled:f}=p;const h=f||!s,[y,A]=(0,n.useState)(!1),m=(0,n.useRef)(null),E=(0,n.useCallback)(k=>{m.current=k},[]);(0,n.useEffect)(()=>{if(s){if(h||y)return;const k=m.current;if(k&&k.tagName)return x(k,S=>S&&A(S),{root:l==null?void 0:l.current,rootMargin:R})}else if(!y){const k=(0,d.requestIdleCallback)(()=>A(!0));return()=>(0,d.cancelIdleCallback)(k)}},[h,R,l,y,m.current]);const I=(0,n.useCallback)(()=>{A(!1)},[]);return[E,y,I]}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(z,z.exports)),z.exports}var K={exports:{}},De;function Rr(){return De||(De=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getDomainLocale",{enumerable:!0,get:function(){return n}}),ur();function n(d,s,o,i){return!1}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(K,K.exports)),K.exports}var oe={},Le;function Er(){return Le||(Le=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return e}});let e=n=>{}}(oe)),oe}var ke;function Fr(){return ke||(ke=1,function(r,e){"use client";Object.defineProperty(e,"__esModule",{value:!0});function n(a,D){for(var C in D)Object.defineProperty(a,C,{enumerable:!0,get:D[C]})}n(e,{default:function(){return Ze},useLinkStatus:function(){return B}});const d=ar(),s=sr(),o=d._(He()),i=lr(),u=cr(),x=dr(),b=fr(),p=pr(),l=gr(),R=kr(),f=Rr(),h=mr(),y=vr();Er();const A=new Set;function m(a,D,C,_){if(!(typeof window>"u")&&(0,u.isLocalURL)(D)){if(!_.bypassPrefetchedCheck){const M=typeof _.locale<"u"?_.locale:"locale"in a?a.locale:void 0,j=D+"%"+C+"%"+M;if(A.has(j))return;A.add(j)}a.prefetch(D,C,_).catch(M=>{})}}function E(a){const C=a.currentTarget.getAttribute("target");return C&&C!=="_self"||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||a.nativeEvent&&a.nativeEvent.which===2}function I(a,D,C,_,M,j,G,Y,Z){const{nodeName:ee}=a.currentTarget;if(ee.toUpperCase()==="A"&&E(a)||a.currentTarget.hasAttribute("download"))return;if(!(0,u.isLocalURL)(C)){M&&(a.preventDefault(),location.replace(C));return}a.preventDefault(),(()=>{if(Z){let J=!1;if(Z({preventDefault:()=>{J=!0}}),J)return}const q=G??!0;"beforePopState"in D?D[M?"replace":"push"](C,_,{shallow:j,locale:Y,scroll:q}):D[M?"replace":"push"](_||C,{scroll:q})})()}function k(a){return typeof a=="string"?a:(0,x.formatUrl)(a)}const P=o.default.forwardRef(function(D,C){let _;const{href:M,as:j,children:G,prefetch:Y=null,passHref:Z,replace:ee,shallow:ue,scroll:le,locale:q,onClick:J,onNavigate:$e,onMouseEnter:ce,onTouchStart:de,legacyBehavior:F=!1,...We}=D;_=G,F&&(typeof _=="string"||typeof _=="number")&&(_=(0,s.jsx)("a",{children:_}));const t=o.default.useContext(l.RouterContext),fe=Y!==!1,{href:U,as:L}=o.default.useMemo(()=>{if(!t){const he=k(M);return{href:he,as:j?k(j):he}}const[v,O]=(0,i.resolveHref)(t,M,!0);return{href:v,as:j?(0,i.resolveHref)(t,j):O||v}},[t,M,j]),pe=o.default.useRef(U),me=o.default.useRef(L);let g;F&&(g=o.default.Children.only(_));const ze=F?g&&typeof g=="object"&&g.ref:C,[ge,ve,be]=(0,R.useIntersection)({rootMargin:"200px"}),Ke=o.default.useCallback(v=>{(me.current!==L||pe.current!==U)&&(be(),me.current=L,pe.current=U),ge(v)},[L,U,be,ge]),Qe=(0,y.useMergedRef)(Ke,ze);o.default.useEffect(()=>{t&&(!ve||!fe||m(t,U,L,{locale:q}))},[L,U,ve,q,fe,t==null?void 0:t.locale,t]);const $={ref:Qe,onClick(v){!F&&typeof J=="function"&&J(v),F&&g.props&&typeof g.props.onClick=="function"&&g.props.onClick(v),t&&(v.defaultPrevented||I(v,t,U,L,ee,ue,le,q,$e))},onMouseEnter(v){!F&&typeof ce=="function"&&ce(v),F&&g.props&&typeof g.props.onMouseEnter=="function"&&g.props.onMouseEnter(v),t&&m(t,U,L,{locale:q,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(O){!F&&typeof de=="function"&&de(O),F&&g.props&&typeof g.props.onTouchStart=="function"&&g.props.onTouchStart(O),t&&m(t,U,L,{locale:q,priority:!0,bypassPrefetchedCheck:!0})}};if((0,b.isAbsoluteUrl)(L))$.href=L;else if(!F||Z||g.type==="a"&&!("href"in g.props)){const v=typeof q<"u"?q:t==null?void 0:t.locale,O=(t==null?void 0:t.isLocaleDomain)&&(0,f.getDomainLocale)(L,v,t==null?void 0:t.locales,t==null?void 0:t.domainLocales);$.href=O||(0,h.addBasePath)((0,p.addLocale)(L,v,t==null?void 0:t.defaultLocale))}return F?o.default.cloneElement(g,$):(0,s.jsx)("a",{...We,...$,children:_})}),S=(0,o.createContext)({pending:!1}),B=()=>(0,o.useContext)(S),Ze=P;(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(W,W.exports)),W.exports}var te,Re;function wr(){return Re||(Re=1,te=Fr()),te}var Mr=wr();const jr=nr(Mr),Q=({group:r,users:e,roomUrl:n,isAvatarModalOpen:d,usedAvatars:s,onJoinClick:o,onUserSelect:i,onAvatarModalClose:u,onJoinConfirm:x})=>r?c.jsxs(ne,{bg:"gray.50",minH:"100vh",py:[4,8],children:[c.jsx(ae,{maxW:"container.lg",children:c.jsxs(_e,{gap:6,children:[c.jsx(re,{fontSize:["xl","2xl"],fontWeight:"bold",color:"gray.800",children:"ドラフトルーム"}),c.jsx(Cr,{group:r,roomUrl:n}),c.jsx(yr,{users:e||[],onJoinClick:o,onUserSelect:i}),c.jsx(jr,{href:"/",children:c.jsx(er,{variant:"outline",size:"sm",children:"ルームを退出"})})]})}),c.jsx(hr,{isOpen:d,onClose:u,onConfirm:x,usedAvatars:s})]}):c.jsx(ne,{bg:"gray.50",minH:"100vh",py:[4,8],children:c.jsx(ae,{maxW:"container.lg",children:c.jsxs(_e,{gap:6,children:[c.jsx(re,{fontSize:["xl","2xl"],fontWeight:"bold",color:"red.600",children:"ルームが見つかりません"}),c.jsx(re,{color:"gray.600",children:"指定されたルームが存在しないか、削除されている可能性があります。"})]})})}),Ee=({groupId:r})=>{const{isAuthenticated:e,signInAnonymous:n,loading:d}=tr(),{group:s,loading:o,error:i}=Ar(r),{users:u,loading:x,error:b}=Dr(r),{createUser:p}=Lr(),l=br(),[R,f]=w.useState(!1),{errorToast:h,successToast:y}=or();w.useEffect(()=>{},[e,d,n,h]);const A=`https://example.com/lobby/${r}`,m=o||x||!1;(i||b)&&(console.error("Firebase Error:",{groupError:i,usersError:b}),h("データの取得に失敗しました"));const E=(u==null?void 0:u.map(P=>P.avatar))||[],I=async P=>{const S=_r();try{await p(r,P.name,P.avatar,S),sessionStorage.setItem("onlinedraft_user_id",S),l.push(`/draft/${r}`),y("ドラフトに参加しました！")}catch(B){console.error("参加エラー:",B),h(B instanceof Error?B.message:"参加に失敗しました")}},k=P=>{sessionStorage.setItem("onlinedraft_user_id",P),l.push(`/draft/${r}`),y("ドラフトに参加しました！")};return m?c.jsx(ne,{bg:"gray.50",minH:"100vh",py:[4,8],children:c.jsx(ae,{maxW:"container.lg",children:c.jsx(rr,{message:"ローディング中..."})})}):c.jsx(Q,{group:s,users:u,roomUrl:A,isAvatarModalOpen:R,usedAvatars:E,onJoinClick:()=>f(!0),onUserSelect:k,onAvatarModalClose:()=>f(!1),onJoinConfirm:I})};try{Q.displayName="LobbyPageInner",Q.__docgenInfo={description:`ロビー画面Innerコンポーネント（Presenter）
UI描画のみを担当、propsでデータとハンドラーを受け取る
Firebaseやビジネスロジックには依存しない純粋なUIコンポーネント`,displayName:"LobbyPageInner",props:{group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"GroupDataType | null"}},users:{defaultValue:null,description:"",name:"users",required:!0,type:{name:"UserDataType[] | null"}},roomUrl:{defaultValue:null,description:"",name:"roomUrl",required:!0,type:{name:"string"}},isAvatarModalOpen:{defaultValue:null,description:"",name:"isAvatarModalOpen",required:!0,type:{name:"boolean"}},usedAvatars:{defaultValue:null,description:"",name:"usedAvatars",required:!0,type:{name:"string[]"}},onJoinClick:{defaultValue:null,description:"",name:"onJoinClick",required:!0,type:{name:"() => void"}},onUserSelect:{defaultValue:null,description:"",name:"onUserSelect",required:!0,type:{name:"(userId: string) => void"}},onAvatarModalClose:{defaultValue:null,description:"",name:"onAvatarModalClose",required:!0,type:{name:"() => void"}},onJoinConfirm:{defaultValue:null,description:"",name:"onJoinConfirm",required:!0,type:{name:"(userData: { name: string; avatar: string; }) => void"}}}}}catch{}try{Ee.displayName="LobbyPage",Ee.__docgenInfo={description:`ロビー画面コンポーネント（Container）
ロジック・データ取得・認証のみを担当
LobbyPageInnerにpropsを渡すのみ`,displayName:"LobbyPage",props:{groupId:{defaultValue:null,description:"",name:"groupId",required:!0,type:{name:"string"}}}}}catch{}const Lo={title:"Features/Lobby/LobbyPage",component:Q,parameters:{layout:"fullscreen"},tags:["autodocs"]},Ge={groupName:"2024年プロ野球ドラフト",createdAt:new Date("2024-06-17T10:00:00Z"),updatedAt:new Date("2024-06-17T10:00:00Z"),status:"waiting",maxParticipants:8},qr=[{userId:"user1",userName:"たろう",groupId:"group123",avatar:"1",joinedAt:T.fromDate(new Date("2024-06-17T10:00:00Z")),updatedAt:T.fromDate(new Date("2024-06-17T10:00:00Z")),isActive:!0},{userId:"user2",userName:"はなこ",groupId:"group123",avatar:"2",joinedAt:T.fromDate(new Date("2024-06-17T10:05:00Z")),updatedAt:T.fromDate(new Date("2024-06-17T10:05:00Z")),isActive:!0},{userId:"user3",userName:"じろう",groupId:"group123",avatar:"3",joinedAt:T.fromDate(new Date("2024-06-17T10:10:00Z")),updatedAt:T.fromDate(new Date("2024-06-17T10:10:00Z")),isActive:!1}],N={args:{group:Ge,users:qr,roomUrl:"https://onlinedraft.com/lobby/abc123",loading:!1,isAvatarModalOpen:!1,usedAvatars:["1","2","3"],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}},V={args:{group:null,users:null,roomUrl:"",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>{},onLeaveRoom:()=>{},onAvatarModalClose:()=>{},onJoinConfirm:()=>{}}},H={args:{group:{...Ge,groupName:"新規作成ルーム"},users:[],roomUrl:"https://onlinedraft.com/lobby/newroom123",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}};var Fe,we,Me,je,qe;N.parameters={...N.parameters,docs:{...(Fe=N.parameters)==null?void 0:Fe.docs,source:{originalSource:`{
  args: {
    group: mockGroup,
    users: mockUsers,
    roomUrl: 'https://onlinedraft.com/lobby/abc123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: ['1', '2', '3'],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Me=(we=N.parameters)==null?void 0:we.docs)==null?void 0:Me.source},description:{story:`基本のロビーページ表示（3人参加）
Firebaseロジックを含まない純粋なUIテスト`,...(qe=(je=N.parameters)==null?void 0:je.docs)==null?void 0:qe.description}}};var xe,Pe,Ue,Ie,Se;V.parameters={...V.parameters,docs:{...(xe=V.parameters)==null?void 0:xe.docs,source:{originalSource:`{
  args: {
    group: null,
    users: null,
    roomUrl: '',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => {},
    onLeaveRoom: () => {},
    onAvatarModalClose: () => {},
    onJoinConfirm: () => {}
  }
}`,...(Ue=(Pe=V.parameters)==null?void 0:Pe.docs)==null?void 0:Ue.source},description:{story:"ルームが見つからない状態",...(Se=(Ie=V.parameters)==null?void 0:Ie.docs)==null?void 0:Se.description}}};var Oe,Te,Be,Je,Ne;H.parameters={...H.parameters,docs:{...(Oe=H.parameters)==null?void 0:Oe.docs,source:{originalSource:`{
  args: {
    group: {
      ...mockGroup,
      groupName: '新規作成ルーム'
    },
    users: [],
    roomUrl: 'https://onlinedraft.com/lobby/newroom123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Be=(Te=H.parameters)==null?void 0:Te.docs)==null?void 0:Be.source},description:{story:"参加者なし（新規ルーム）",...(Ne=(Je=H.parameters)==null?void 0:Je.docs)==null?void 0:Ne.description}}};const ko=["Basic","RoomNotFound","EmptyRoom"];export{N as Basic,H as EmptyRoom,V as RoomNotFound,ko as __namedExportsOrder,Lo as default};
