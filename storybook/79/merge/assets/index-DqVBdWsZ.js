import{j as n}from"./create-recipe-context-oy0ofMwS.js";import{R as C}from"./responsive-modal-VBDbG9cT.js";import{r as k}from"./index-BXymfbzT.js";import{V as x}from"./v-stack-DNelLgfG.js";import{B as c}from"./box-D1Z_KUxa.js";import{H as p}from"./h-stack-e-BLBiSK.js";import{I as M}from"./image-CisOvN2U.js";import{T as i}from"./text-DkCoEBoG.js";import{B as R}from"./button-DFylk1V_.js";import{I as v}from"./input-n8mBWrzc.js";import{T as D}from"./textarea-DbTSzehL.js";const y=({isOpen:u,onClose:g,roundData:d,participants:h,onSaveSelections:j})=>{const[s,l]=k.useState({editMode:{},tempData:{}});if(!d)return null;const S=o=>{l(e=>{var r,t;return{...e,editMode:{...e.editMode,[o]:!e.editMode[o]},tempData:e.editMode[o]?e.tempData:{...e.tempData,[o]:{item:((r=d.selections.find(a=>a.userId===o))==null?void 0:r.item)||"",comment:((t=d.selections.find(a=>a.userId===o))==null?void 0:t.comment)||""}}}})},f=(o,e,r)=>{l(t=>({...t,tempData:{...t.tempData,[o]:{...t.tempData[o],[e]:r}}}))},b=()=>Object.keys(s.tempData).some(o=>{const e=d.selections.find(t=>t.userId===o),r=s.tempData[o];return r&&(r.item!==((e==null?void 0:e.item)||"")||r.comment!==((e==null?void 0:e.comment)||""))}),_=()=>{const o=h.map(e=>{const r=s.tempData[e.id],t=d.selections.find(a=>a.userId===e.id);return r?{userId:e.id,userName:e.name,item:r.item,comment:r.comment}:t||{userId:e.id,userName:e.name,item:"",comment:""}}).filter(e=>e.item.trim()!=="");j(d.roundNumber,o),l({editMode:{},tempData:{}}),g()},m=()=>{l({editMode:{},tempData:{}}),g()};return n.jsx(C,{isOpen:u,onClose:b()?()=>{confirm("未保存の変更があります。閉じますか？")&&m()}:m,title:`ラウンド ${d.roundNumber}: ${d.topic}`,actions:{cancel:{text:"キャンセル",onClick:m},submit:{text:"保存",colorPalette:"green",disabled:!b(),onClick:_}},children:n.jsx(x,{gap:4,align:"stretch",w:"full",children:h.map(o=>{const e=d.selections.find(a=>a.userId===o.id),r=s.editMode[o.id],t=s.tempData[o.id];return n.jsxs(c,{p:4,borderRadius:"lg",border:"1px solid",borderColor:"gray.200",bg:"white",_dark:{bg:"gray.800",borderColor:"gray.600"},children:[n.jsxs(p,{justify:"space-between",mb:3,children:[n.jsxs(p,{gap:3,children:[n.jsx(M,{src:`/img/${o.avatar}.png`,alt:o.name,width:"32px",height:"32px",borderRadius:"md",objectFit:"cover"}),n.jsx(i,{fontWeight:"bold",color:"gray.800",_dark:{color:"gray.200"},children:o.name})]}),n.jsx(R,{size:"sm",variant:"outline",colorPalette:r?"red":"green",onClick:()=>S(o.id),children:r?"キャンセル":"編集"})]}),n.jsxs(x,{gap:3,align:"stretch",children:[n.jsxs(c,{children:[r&&n.jsx(i,{fontSize:"sm",fontWeight:"medium",mb:1,color:"gray.600",_dark:{color:"gray.400"},children:"選択"}),r?n.jsx(v,{value:(t==null?void 0:t.item)||"",onChange:a=>f(o.id,"item",a.target.value),placeholder:"選択を入力...",size:"sm",borderWidth:2,borderColor:"gray.300",_focus:{borderColor:"green.500",boxShadow:"0 0 0 1px var(--chakra-colors-green-500)"},_dark:{borderColor:"gray.600",bg:"gray.700",_focus:{borderColor:"green.400",boxShadow:"0 0 0 1px var(--chakra-colors-green-400)"}}}):n.jsx(i,{fontSize:"lg",fontWeight:"bold",color:"gray.800",_dark:{color:"gray.200"},children:(e==null?void 0:e.item)||"未選択"})]}),n.jsxs(c,{children:[r&&n.jsx(i,{fontSize:"sm",fontWeight:"medium",mb:1,color:"green.600",_dark:{color:"green.300"},children:"コメント"}),r?n.jsx(D,{value:(t==null?void 0:t.comment)||"",onChange:a=>f(o.id,"comment",a.target.value),placeholder:"コメントを入力...",rows:2,resize:"none",size:"sm",borderWidth:2,borderColor:"gray.300",_focus:{borderColor:"green.500",boxShadow:"0 0 0 1px var(--chakra-colors-green-500)"},_dark:{borderColor:"gray.600",bg:"gray.700",_focus:{borderColor:"green.400",boxShadow:"0 0 0 1px var(--chakra-colors-green-400)"}}}):n.jsx(i,{fontSize:"sm",color:"green.600",fontStyle:e!=null&&e.comment?"italic":"normal",_dark:{color:"green.300"},children:(e==null?void 0:e.comment)||"（コメントなし）"})]})]})]},o.id)})})})};try{y.displayName="RoundDetailModal",y.__docgenInfo={description:"",displayName:"RoundDetailModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},roundData:{defaultValue:null,description:"",name:"roundData",required:!0,type:{name:"RoundData | null"}},participants:{defaultValue:null,description:"",name:"participants",required:!0,type:{name:"Participant[]"}},onSaveSelections:{defaultValue:null,description:"",name:"onSaveSelections",required:!0,type:{name:"(roundNumber: number, selections: RoundSelection[]) => void"}}}}}catch{}export{y as R};
