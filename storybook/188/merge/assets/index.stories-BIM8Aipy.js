import{c as Be,d as Je,s as Qe,b as ve,T as O}from"./index.esm2017-BvcukJ0n.js";import{j as a}from"./stack-B25eOQea.js";import{B as Xe}from"./index-C9wqLcGi.js";import{L as Ye}from"./index-Cki5ZDSJ.js";import{u as er}from"./toaster-Du-873cZ.js";import{d as Se,v as G,a as rr}from"./common-CDA3LAea.js";import{u as or}from"./useFirebaseAuth-DnJAt0Ke.js";import{a as tr,u as nr}from"./useRealtimeUsers-CVy_IELV.js";import{r as oe,b as Ne,g as ar}from"./index-BXymfbzT.js";import{a as sr}from"./_interop_require_wildcard-BpaVepTj.js";import{r as ir}from"./jsx-runtime-Bw5QeaCk.js";import{r as ur,w as lr,q as cr,s as dr,n as fr,b as pr,o as mr,p as gr}from"./add-base-path-CP-wUZSB.js";import{a as vr}from"./image-context-B4PdNff0.js";import{r as br}from"./index-CWtFKQuP.js";import{u as yr}from"./index-yHYUIvBd.js";import{A as hr}from"./index-BXO3a4w7.js";import{P as Cr}from"./index-BA4XgWR7.js";import{R as _r}from"./index-FolBK5UZ.js";import{B as te}from"./box-BDoFiJcT.js";import{C as ne}from"./container-DUbPfsQN.js";import{V as be}from"./v-stack-DLbVHDKJ.js";import{T as Y}from"./text-ddCD_fM-.js";import"./button-BzGfOniU.js";import"./attr-C3Jtgmrz.js";import"./spinner-BaqUdWIg.js";import"./index-BRNWFSEf.js";import"./index-BPRKcNEv.js";import"./index-DGKHe-6Q.js";import"./create-slot-recipe-context-BILcAqFF.js";import"./index-DQKawd5P.js";import"./factory-CQjN0O8Q.js";import"./index-D3iQu9n-.js";import"./index-CrjboX4Z.js";import"./index-6PFvwfVV.js";import"./index-C0w2AICy.js";import"./zod-C0AimxcA.js";import"./index-Bxr0EmBi.js";import"./responsive-modal-Y5TxC2k_.js";import"./index-ByYvEZYI.js";import"./icon-button-CZw3PtnZ.js";import"./render-strategy-CvFi1cA2.js";import"./index-D_DKZCCl.js";import"./use-breakpoint-BiEj9wsk.js";import"./simple-grid-DKuTOOEA.js";import"./grid-W1xKhCbE.js";import"./types-JQgdQoTs.js";import"./index-_ZCxv-ro.js";import"./card-BfIoSqEc.js";import"./h-stack-Bm4oIVhc.js";const Ar=()=>{const r=Be(Se,"_temp");return Je(r).id},Dr=()=>{const r=Be(Se,"app/onlinedraft/user");return{createUser:oe.useCallback(async(s,g,v,t)=>{G(s,"グループID"),G(g,"ユーザー名"),rr(g,20,"ユーザー名"),G(v,"アバター"),G(t,"ユーザーID");const i={userId:t,userName:g.trim(),groupId:s.trim(),avatar:v.trim()};try{const C=Je(r,t);await Qe(C,{...i,joinedAt:ve(),updatedAt:ve()})}catch(C){throw C instanceof Error?new Error(`ユーザー作成に失敗しました: ${C.message}`):new Error("ユーザー作成中に予期しないエラーが発生しました")}},[r]),userCollection:r}};var $={exports:{}},W={exports:{}},ye;function kr(){return ye||(ye=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useIntersection",{enumerable:!0,get:function(){return E}});const s=Ne(),g=ur(),v=typeof IntersectionObserver=="function",t=new Map,i=[];function C(b){const l={root:b.root||null,margin:b.rootMargin||""},R=i.find(h=>h.root===l.root&&h.margin===l.margin);let u;if(R&&(u=t.get(R),u))return u;const _=new Map,y=new IntersectionObserver(h=>{h.forEach(c=>{const F=_.get(c.target),A=c.isIntersecting||c.intersectionRatio>0;F&&A&&F(A)})},b);return u={id:l,observer:y,elements:_},i.push(l),t.set(l,u),u}function P(b,l,R){const{id:u,observer:_,elements:y}=C(R);return y.set(b,l),_.observe(b),function(){if(y.delete(b),_.unobserve(b),y.size===0){_.disconnect(),t.delete(u);const c=i.findIndex(F=>F.root===u.root&&F.margin===u.margin);c>-1&&i.splice(c,1)}}}function E(b){let{rootRef:l,rootMargin:R,disabled:u}=b;const _=u||!v,[y,h]=(0,s.useState)(!1),c=(0,s.useRef)(null),F=(0,s.useCallback)(D=>{c.current=D},[]);(0,s.useEffect)(()=>{if(v){if(_||y)return;const D=c.current;if(D&&D.tagName)return P(D,N=>N&&h(N),{root:l==null?void 0:l.current,rootMargin:R})}else if(!y){const D=(0,g.requestIdleCallback)(()=>h(!0));return()=>(0,g.cancelIdleCallback)(D)}},[_,R,l,y,c.current]);const A=(0,s.useCallback)(()=>{h(!1)},[]);return[F,y,A]}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(W,W.exports)),W.exports}var z={exports:{}},he;function Lr(){return he||(he=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getDomainLocale",{enumerable:!0,get:function(){return s}}),lr();function s(g,v,t,i){return!1}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(z,z.exports)),z.exports}var ee={},Ce;function Rr(){return Ce||(Ce=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return e}});let e=s=>{}}(ee)),ee}var _e;function Fr(){return _e||(_e=1,function(r,e){"use client";Object.defineProperty(e,"__esModule",{value:!0});function s(n,k){for(var p in k)Object.defineProperty(n,p,{enumerable:!0,get:k[p]})}s(e,{default:function(){return Ze},useLinkStatus:function(){return He}});const g=sr(),v=ir(),t=g._(Ne()),i=cr(),C=dr(),P=fr(),E=pr(),b=mr(),l=vr(),R=kr(),u=Lr(),_=gr(),y=br();Rr();const h=new Set;function c(n,k,p,m){if(!(typeof window>"u")&&(0,C.isLocalURL)(k)){if(!m.bypassPrefetchedCheck){const j=typeof m.locale<"u"?m.locale:"locale"in n?n.locale:void 0,q=k+"%"+p+"%"+j;if(h.has(q))return;h.add(q)}n.prefetch(k,p,m).catch(j=>{})}}function F(n){const p=n.currentTarget.getAttribute("target");return p&&p!=="_self"||n.metaKey||n.ctrlKey||n.shiftKey||n.altKey||n.nativeEvent&&n.nativeEvent.which===2}function A(n,k,p,m,j,q,V,Q,H){const{nodeName:X}=n.currentTarget;if(X.toUpperCase()==="A"&&F(n)||n.currentTarget.hasAttribute("download"))return;if(!(0,C.isLocalURL)(p)){j&&(n.preventDefault(),location.replace(p));return}n.preventDefault(),(()=>{if(H){let T=!1;if(H({preventDefault:()=>{T=!0}}),T)return}const x=V??!0;"beforePopState"in k?k[j?"replace":"push"](p,m,{shallow:q,locale:Q,scroll:x}):k[j?"replace":"push"](m||p,{scroll:x})})()}function D(n){return typeof n=="string"?n:(0,P.formatUrl)(n)}const U=t.default.forwardRef(function(k,p){let m;const{href:j,as:q,children:V,prefetch:Q=null,passHref:H,replace:X,shallow:ae,scroll:se,locale:x,onClick:T,onNavigate:Ge,onMouseEnter:ie,onTouchStart:ue,legacyBehavior:M=!1,...$e}=k;m=V,M&&(typeof m=="string"||typeof m=="number")&&(m=(0,v.jsx)("a",{children:m}));const o=t.default.useContext(l.RouterContext),le=Q!==!1,{href:I,as:L}=t.default.useMemo(()=>{if(!o){const ge=D(j);return{href:ge,as:q?D(q):ge}}const[f,w]=(0,i.resolveHref)(o,j,!0);return{href:f,as:q?(0,i.resolveHref)(o,q):w||f}},[o,j,q]),ce=t.default.useRef(I),de=t.default.useRef(L);let d;M&&(d=t.default.Children.only(m));const We=M?d&&typeof d=="object"&&d.ref:p,[fe,pe,me]=(0,R.useIntersection)({rootMargin:"200px"}),ze=t.default.useCallback(f=>{(de.current!==L||ce.current!==I)&&(me(),de.current=L,ce.current=I),fe(f)},[L,I,me,fe]),Ke=(0,y.useMergedRef)(ze,We);t.default.useEffect(()=>{o&&(!pe||!le||c(o,I,L,{locale:x}))},[L,I,pe,x,le,o==null?void 0:o.locale,o]);const Z={ref:Ke,onClick(f){!M&&typeof T=="function"&&T(f),M&&d.props&&typeof d.props.onClick=="function"&&d.props.onClick(f),o&&(f.defaultPrevented||A(f,o,I,L,X,ae,se,x,Ge))},onMouseEnter(f){!M&&typeof ie=="function"&&ie(f),M&&d.props&&typeof d.props.onMouseEnter=="function"&&d.props.onMouseEnter(f),o&&c(o,I,L,{locale:x,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(w){!M&&typeof ue=="function"&&ue(w),M&&d.props&&typeof d.props.onTouchStart=="function"&&d.props.onTouchStart(w),o&&c(o,I,L,{locale:x,priority:!0,bypassPrefetchedCheck:!0})}};if((0,E.isAbsoluteUrl)(L))Z.href=L;else if(!M||H||d.type==="a"&&!("href"in d.props)){const f=typeof x<"u"?x:o==null?void 0:o.locale,w=(o==null?void 0:o.isLocaleDomain)&&(0,u.getDomainLocale)(L,f,o==null?void 0:o.locales,o==null?void 0:o.domainLocales);Z.href=w||(0,_.addBasePath)((0,b.addLocale)(L,f,o==null?void 0:o.defaultLocale))}return M?t.default.cloneElement(d,Z):(0,v.jsx)("a",{...$e,...Z,children:m})}),N=(0,t.createContext)({pending:!1}),He=()=>(0,t.useContext)(N),Ze=U;(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}($,$.exports)),$.exports}var re,Ae;function Mr(){return Ae||(Ae=1,re=Fr()),re}var jr=Mr();const qr=ar(jr),K=({group:r,users:e,roomUrl:s,isAvatarModalOpen:g,usedAvatars:v,onJoinClick:t,onUserSelect:i,onAvatarModalClose:C,onJoinConfirm:P})=>r?a.jsxs(te,{bg:"gray.50",minH:"100vh",py:[4,8],children:[a.jsx(ne,{maxW:"container.lg",children:a.jsxs(be,{gap:6,children:[a.jsx(Y,{fontSize:["xl","2xl"],fontWeight:"bold",color:"gray.800",children:"ドラフトルーム"}),a.jsx(_r,{group:r,roomUrl:s}),a.jsx(Cr,{users:e||[],onJoinClick:t,onUserSelect:i}),a.jsx(qr,{href:"/",children:a.jsx(Xe,{variant:"outline",size:"sm",children:"ルームを退出"})})]})}),a.jsx(hr,{isOpen:g,onClose:C,onConfirm:P,usedAvatars:v})]}):a.jsx(te,{bg:"gray.50",minH:"100vh",py:[4,8],children:a.jsx(ne,{maxW:"container.lg",children:a.jsxs(be,{gap:6,children:[a.jsx(Y,{fontSize:["xl","2xl"],fontWeight:"bold",color:"red.600",children:"ルームが見つかりません"}),a.jsx(Y,{color:"gray.600",children:"指定されたルームが存在しないか、削除されている可能性があります。"})]})})}),De=({groupId:r})=>{const{isAuthenticated:e,signInAnonymous:s,loading:g}=or(),{group:v,loading:t}=tr(r),{users:i,loading:C}=nr(r),{createUser:P}=Dr(),E=yr(),[b,l]=oe.useState(!1),{errorToast:R,successToast:u}=er();oe.useEffect(()=>{},[e,g,s,R]);const _=`https://example.com/lobby/${r}`,y=t||C||!1,h=(i==null?void 0:i.map(A=>A.avatar))||[],c=async A=>{const D=Ar();try{await P(r,A.name,A.avatar,D),sessionStorage.setItem("onlinedraft_user_id",D),E.push(`/draft/${r}`),u("ドラフトに参加しました！")}catch(U){console.error("参加エラー:",U),R(U instanceof Error?U.message:"参加に失敗しました")}},F=A=>{sessionStorage.setItem("onlinedraft_user_id",A),E.push(`/draft/${r}`),u("ドラフトに参加しました！")};return y||!e||g||!v?a.jsx(te,{bg:"gray.50",minH:"100vh",py:[4,8],children:a.jsx(ne,{maxW:"container.lg",children:a.jsx(Ye,{message:"ローディング中..."})})}):a.jsx(K,{group:v,users:i,roomUrl:_,isAvatarModalOpen:b,usedAvatars:h,onJoinClick:()=>l(!0),onUserSelect:F,onAvatarModalClose:()=>l(!1),onJoinConfirm:c})};try{K.displayName="LobbyPageInner",K.__docgenInfo={description:`ロビー画面Innerコンポーネント（Presenter）
UI描画のみを担当、propsでデータとハンドラーを受け取る
Firebaseやビジネスロジックには依存しない純粋なUIコンポーネント`,displayName:"LobbyPageInner",props:{group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"GroupDataType | null"}},users:{defaultValue:null,description:"",name:"users",required:!0,type:{name:"UserDataType[] | null"}},roomUrl:{defaultValue:null,description:"",name:"roomUrl",required:!0,type:{name:"string"}},isAvatarModalOpen:{defaultValue:null,description:"",name:"isAvatarModalOpen",required:!0,type:{name:"boolean"}},usedAvatars:{defaultValue:null,description:"",name:"usedAvatars",required:!0,type:{name:"string[]"}},onJoinClick:{defaultValue:null,description:"",name:"onJoinClick",required:!0,type:{name:"() => void"}},onUserSelect:{defaultValue:null,description:"",name:"onUserSelect",required:!0,type:{name:"(userId: string) => void"}},onAvatarModalClose:{defaultValue:null,description:"",name:"onAvatarModalClose",required:!0,type:{name:"() => void"}},onJoinConfirm:{defaultValue:null,description:"",name:"onJoinConfirm",required:!0,type:{name:"(userData: { name: string; avatar: string; }) => void"}}}}}catch{}try{De.displayName="LobbyPage",De.__docgenInfo={description:`ロビー画面コンポーネント（Container）
ロジック・データ取得・認証のみを担当
LobbyPageInnerにpropsを渡すのみ`,displayName:"LobbyPage",props:{groupId:{defaultValue:null,description:"",name:"groupId",required:!0,type:{name:"string"}}}}}catch{}const Mo={title:"features/lobby/LobbyPage",component:K,parameters:{layout:"fullscreen"}},Ve={groupName:"2024年プロ野球ドラフト",createdAt:new Date("2024-06-17T10:00:00Z"),updatedAt:new Date("2024-06-17T10:00:00Z"),status:"waiting",maxParticipants:8},xr=[{userId:"user1",userName:"たろう",groupId:"group123",avatar:"1",joinedAt:O.fromDate(new Date("2024-06-17T10:00:00Z")),updatedAt:O.fromDate(new Date("2024-06-17T10:00:00Z")),isActive:!0},{userId:"user2",userName:"はなこ",groupId:"group123",avatar:"2",joinedAt:O.fromDate(new Date("2024-06-17T10:05:00Z")),updatedAt:O.fromDate(new Date("2024-06-17T10:05:00Z")),isActive:!0},{userId:"user3",userName:"じろう",groupId:"group123",avatar:"3",joinedAt:O.fromDate(new Date("2024-06-17T10:10:00Z")),updatedAt:O.fromDate(new Date("2024-06-17T10:10:00Z")),isActive:!1}],B={args:{group:Ve,users:xr,roomUrl:"https://onlinedraft.com/lobby/abc123",loading:!1,isAvatarModalOpen:!1,usedAvatars:["1","2","3"],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}},J={args:{group:null,users:null,roomUrl:"",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>{},onLeaveRoom:()=>{},onAvatarModalClose:()=>{},onJoinConfirm:()=>{}}},S={args:{group:{...Ve,groupName:"新規作成ルーム"},users:[],roomUrl:"https://onlinedraft.com/lobby/newroom123",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}};var ke,Le,Re,Fe,Me;B.parameters={...B.parameters,docs:{...(ke=B.parameters)==null?void 0:ke.docs,source:{originalSource:`{
  args: {
    group: mockGroup,
    users: mockUsers,
    roomUrl: 'https://onlinedraft.com/lobby/abc123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: ['1', '2', '3'],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Re=(Le=B.parameters)==null?void 0:Le.docs)==null?void 0:Re.source},description:{story:`基本のロビーページ表示（3人参加）
Firebaseロジックを含まない純粋なUIテスト`,...(Me=(Fe=B.parameters)==null?void 0:Fe.docs)==null?void 0:Me.description}}};var je,qe,xe,Ie,Pe;J.parameters={...J.parameters,docs:{...(je=J.parameters)==null?void 0:je.docs,source:{originalSource:`{
  args: {
    group: null,
    users: null,
    roomUrl: '',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => {},
    onLeaveRoom: () => {},
    onAvatarModalClose: () => {},
    onJoinConfirm: () => {}
  }
}`,...(xe=(qe=J.parameters)==null?void 0:qe.docs)==null?void 0:xe.source},description:{story:"ルームが見つからない状態",...(Pe=(Ie=J.parameters)==null?void 0:Ie.docs)==null?void 0:Pe.description}}};var Ee,Ue,we,Oe,Te;S.parameters={...S.parameters,docs:{...(Ee=S.parameters)==null?void 0:Ee.docs,source:{originalSource:`{
  args: {
    group: {
      ...mockGroup,
      groupName: '新規作成ルーム'
    },
    users: [],
    roomUrl: 'https://onlinedraft.com/lobby/newroom123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(we=(Ue=S.parameters)==null?void 0:Ue.docs)==null?void 0:we.source},description:{story:"参加者なし（新規ルーム）",...(Te=(Oe=S.parameters)==null?void 0:Oe.docs)==null?void 0:Te.description}}};const jo=["Basic","RoomNotFound","EmptyRoom"];export{B as Basic,S as EmptyRoom,J as RoomNotFound,jo as __namedExportsOrder,Mo as default};
