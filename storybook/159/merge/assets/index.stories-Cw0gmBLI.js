import{c as Je,d as ae,a as Ke,s as Qe,b as he,T}from"./index.esm2017-mzQehXGw.js";import{j as u}from"./stack-BPGBxmP7.js";import{b as Ne,g as Xe,r as O}from"./index-BXymfbzT.js";import{a as Ye}from"./_interop_require_wildcard-BpaVepTj.js";import{r as er}from"./jsx-runtime-Bw5QeaCk.js";import{r as rr,w as or,q as tr,s as nr,n as ar,b as sr,o as ir,p as ur}from"./add-base-path-CP-wUZSB.js";import{a as lr}from"./image-context-B4PdNff0.js";import{r as cr}from"./index-DryDucYP.js";import{u as dr}from"./index-yHYUIvBd.js";import{B as fr}from"./index-SHODgBQi.js";import{L as pr}from"./index-Bvw4ip2W.js";import{u as mr}from"./toaster-DLO5lbue.js";import{d as se}from"./firebase-DBrNdAmE.js";import{u as gr}from"./useFirebaseAuth-C4BJOuTt.js";import{u as vr}from"./useRealtimeUsers-n9Hs04w7.js";import{A as br}from"./index-BiH3o5pn.js";import{P as hr}from"./index-C-Mx01Sa.js";import{R as yr}from"./index-PWcc1_Qt.js";import{B as te}from"./box-BF69sWHg.js";import{C as ne}from"./container-BeF7NZEH.js";import{V as ye}from"./v-stack-Dfms-mlT.js";import{T as ee}from"./text-CvVCgmJx.js";import"./index-DGKHe-6Q.js";import"./create-slot-recipe-context-BnxH4US7.js";import"./attr-C3Jtgmrz.js";import"./index-Brkr_dpc.js";import"./factory-GA1w9YC2.js";import"./index-Bkt13QoG.js";import"./index-BEZemFFB.js";import"./index-CrjboX4Z.js";import"./index-CmCyOxug.js";import"./index-BRNWFSEf.js";import"./index-C0w2AICy.js";import"./button-DJPprnzD.js";import"./spinner-BfFBc7wa.js";import"./zod-Bx0w6FpW.js";import"./index-Dv0j10SL.js";import"./responsive-modal-DK_jUbPM.js";import"./index-C8TKjGAI.js";import"./icon-button-Cau_blD8.js";import"./render-strategy-Bdhnioqe.js";import"./index-7Dro8rd9.js";import"./use-breakpoint-B2ao55g-.js";import"./simple-grid-q22kchH4.js";import"./grid-mntVVhnA.js";import"./types-DwQkBYn-.js";import"./index-BBhje7zF.js";import"./card-DlhQdIZJ.js";import"./h-stack-CXTYcpFY.js";var W={exports:{}},z={exports:{}},Ce;function Cr(){return Ce||(Ce=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useIntersection",{enumerable:!0,get:function(){return L}});const a=Ne(),g=rr(),l=typeof IntersectionObserver=="function",o=new Map,s=[];function i(C){const d={root:C.root||null,margin:C.rootMargin||""},R=s.find(_=>_.root===d.root&&_.margin===d.margin);let c;if(R&&(c=o.get(R),c))return c;const v=new Map,b=new IntersectionObserver(_=>{_.forEach(f=>{const E=v.get(f.target),I=f.isIntersecting||f.intersectionRatio>0;E&&I&&E(I)})},C);return c={id:d,observer:b,elements:v},s.push(d),o.set(d,c),c}function P(C,d,R){const{id:c,observer:v,elements:b}=i(R);return b.set(C,d),v.observe(C),function(){if(b.delete(C),v.unobserve(C),b.size===0){v.disconnect(),o.delete(c);const f=s.findIndex(E=>E.root===c.root&&E.margin===c.margin);f>-1&&s.splice(f,1)}}}function L(C){let{rootRef:d,rootMargin:R,disabled:c}=C;const v=c||!l,[b,_]=(0,a.useState)(!1),f=(0,a.useRef)(null),E=(0,a.useCallback)(k=>{f.current=k},[]);(0,a.useEffect)(()=>{if(l){if(v||b)return;const k=f.current;if(k&&k.tagName)return P(k,U=>U&&_(U),{root:d==null?void 0:d.current,rootMargin:R})}else if(!b){const k=(0,g.requestIdleCallback)(()=>_(!0));return()=>(0,g.cancelIdleCallback)(k)}},[v,R,d,b,f.current]);const I=(0,a.useCallback)(()=>{_(!1)},[]);return[E,b,I]}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(z,z.exports)),z.exports}var K={exports:{}},_e;function _r(){return _e||(_e=1,function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"getDomainLocale",{enumerable:!0,get:function(){return a}}),or();function a(g,l,o,s){return!1}(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(K,K.exports)),K.exports}var re={},Ae;function Ar(){return Ae||(Ae=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return e}});let e=a=>{}}(re)),re}var De;function Dr(){return De||(De=1,function(r,e){"use client";Object.defineProperty(e,"__esModule",{value:!0});function a(n,A){for(var h in A)Object.defineProperty(n,h,{enumerable:!0,get:A[h]})}a(e,{default:function(){return He},useLinkStatus:function(){return B}});const g=Ye(),l=er(),o=g._(Ne()),s=tr(),i=nr(),P=ar(),L=sr(),C=ir(),d=lr(),R=Cr(),c=_r(),v=ur(),b=cr();Ar();const _=new Set;function f(n,A,h,y){if(!(typeof window>"u")&&(0,i.isLocalURL)(A)){if(!y.bypassPrefetchedCheck){const M=typeof y.locale<"u"?y.locale:"locale"in n?n.locale:void 0,j=A+"%"+h+"%"+M;if(_.has(j))return;_.add(j)}n.prefetch(A,h,y).catch(M=>{})}}function E(n){const h=n.currentTarget.getAttribute("target");return h&&h!=="_self"||n.metaKey||n.ctrlKey||n.shiftKey||n.altKey||n.nativeEvent&&n.nativeEvent.which===2}function I(n,A,h,y,M,j,G,X,Z){const{nodeName:Y}=n.currentTarget;if(Y.toUpperCase()==="A"&&E(n)||n.currentTarget.hasAttribute("download"))return;if(!(0,i.isLocalURL)(h)){M&&(n.preventDefault(),location.replace(h));return}n.preventDefault(),(()=>{if(Z){let J=!1;if(Z({preventDefault:()=>{J=!0}}),J)return}const w=G??!0;"beforePopState"in A?A[M?"replace":"push"](h,y,{shallow:j,locale:X,scroll:w}):A[M?"replace":"push"](y||h,{scroll:w})})()}function k(n){return typeof n=="string"?n:(0,P.formatUrl)(n)}const x=o.default.forwardRef(function(A,h){let y;const{href:M,as:j,children:G,prefetch:X=null,passHref:Z,replace:Y,shallow:ie,scroll:ue,locale:w,onClick:J,onNavigate:Ge,onMouseEnter:le,onTouchStart:ce,legacyBehavior:F=!1,...Ze}=A;y=G,F&&(typeof y=="string"||typeof y=="number")&&(y=(0,l.jsx)("a",{children:y}));const t=o.default.useContext(d.RouterContext),de=X!==!1,{href:q,as:D}=o.default.useMemo(()=>{if(!t){const be=k(M);return{href:be,as:j?k(j):be}}const[m,S]=(0,s.resolveHref)(t,M,!0);return{href:m,as:j?(0,s.resolveHref)(t,j):S||m}},[t,M,j]),fe=o.default.useRef(q),pe=o.default.useRef(D);let p;F&&(p=o.default.Children.only(y));const $e=F?p&&typeof p=="object"&&p.ref:h,[me,ge,ve]=(0,R.useIntersection)({rootMargin:"200px"}),We=o.default.useCallback(m=>{(pe.current!==D||fe.current!==q)&&(ve(),pe.current=D,fe.current=q),me(m)},[D,q,ve,me]),ze=(0,b.useMergedRef)(We,$e);o.default.useEffect(()=>{t&&(!ge||!de||f(t,q,D,{locale:w}))},[D,q,ge,w,de,t==null?void 0:t.locale,t]);const $={ref:ze,onClick(m){!F&&typeof J=="function"&&J(m),F&&p.props&&typeof p.props.onClick=="function"&&p.props.onClick(m),t&&(m.defaultPrevented||I(m,t,q,D,Y,ie,ue,w,Ge))},onMouseEnter(m){!F&&typeof le=="function"&&le(m),F&&p.props&&typeof p.props.onMouseEnter=="function"&&p.props.onMouseEnter(m),t&&f(t,q,D,{locale:w,priority:!0,bypassPrefetchedCheck:!0})},onTouchStart:function(S){!F&&typeof ce=="function"&&ce(S),F&&p.props&&typeof p.props.onTouchStart=="function"&&p.props.onTouchStart(S),t&&f(t,q,D,{locale:w,priority:!0,bypassPrefetchedCheck:!0})}};if((0,L.isAbsoluteUrl)(D))$.href=D;else if(!F||Z||p.type==="a"&&!("href"in p.props)){const m=typeof w<"u"?w:t==null?void 0:t.locale,S=(t==null?void 0:t.isLocaleDomain)&&(0,c.getDomainLocale)(D,m,t==null?void 0:t.locales,t==null?void 0:t.domainLocales);$.href=S||(0,v.addBasePath)((0,C.addLocale)(D,m,t==null?void 0:t.defaultLocale))}return F?o.default.cloneElement(p,$):(0,l.jsx)("a",{...Ze,...$,children:y})}),U=(0,o.createContext)({pending:!1}),B=()=>(0,o.useContext)(U),He=x;(typeof e.default=="function"||typeof e.default=="object"&&e.default!==null)&&typeof e.default.__esModule>"u"&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),r.exports=e.default)}(W,W.exports)),W.exports}var oe,ke;function kr(){return ke||(ke=1,oe=Dr()),oe}var Lr=kr();const Rr=Xe(Lr),Er=()=>{const r=Je(se,"_temp");return ae(r).id},Fr=r=>{const[e,a]=O.useState(null),[g,l]=O.useState(!0),[o,s]=O.useState(null);return O.useEffect(()=>{if(!r){a(null),l(!1);return}const i=ae(se,"app/onlinedraft/group",r);return Ke(i,L=>{L.exists()?a(L.data()):a(null),l(!1),s(null)},L=>{s(L),l(!1)})},[r]),{group:e,loading:g,error:o}},Mr=()=>{const r=Je(se,"app/onlinedraft/user");return{createUser:O.useCallback(async(a,g,l,o)=>{if(!a.trim())throw new Error("グループIDが必要です");if(!g.trim())throw new Error("ユーザー名を入力してください");if(g.length>20)throw new Error("ユーザー名は20文字以内で入力してください");if(!l.trim())throw new Error("アバターを選択してください");if(!o.trim())throw new Error("ユーザーIDが必要です");const s={userId:o,userName:g.trim(),groupId:a.trim(),avatar:l.trim(),isActive:!0};try{const i=ae(r,o);await Qe(i,{...s,joinedAt:he(),updatedAt:he()})}catch(i){throw i instanceof Error?new Error(`ユーザー作成に失敗しました: ${i.message}`):new Error("ユーザー作成中に予期しないエラーが発生しました")}},[r]),userCollection:r}},Q=({group:r,users:e,roomUrl:a,isAvatarModalOpen:g,usedAvatars:l,onJoinClick:o,onUserSelect:s,onAvatarModalClose:i,onJoinConfirm:P})=>r?u.jsxs(te,{bg:"gray.50",minH:"100vh",py:[4,8],children:[u.jsx(ne,{maxW:"container.lg",children:u.jsxs(ye,{gap:6,children:[u.jsx(ee,{fontSize:["xl","2xl"],fontWeight:"bold",color:"gray.800",children:"ドラフトルーム"}),u.jsx(yr,{group:r,roomUrl:a}),u.jsx(hr,{users:e||[],onJoinClick:o,onUserSelect:s}),u.jsx(Rr,{href:"/",children:u.jsx(fr,{variant:"outline",size:"sm",children:"ルームを退出"})})]})}),u.jsx(br,{isOpen:g,onClose:i,onConfirm:P,usedAvatars:l})]}):u.jsx(te,{bg:"gray.50",minH:"100vh",py:[4,8],children:u.jsx(ne,{maxW:"container.lg",children:u.jsxs(ye,{gap:6,children:[u.jsx(ee,{fontSize:["xl","2xl"],fontWeight:"bold",color:"red.600",children:"ルームが見つかりません"}),u.jsx(ee,{color:"gray.600",children:"指定されたルームが存在しないか、削除されている可能性があります。"})]})})}),Le=({groupId:r})=>{const{isAuthenticated:e,signInAnonymous:a,loading:g}=gr(),{group:l,loading:o,error:s}=Fr(r),{users:i,loading:P,error:L}=vr(r),{createUser:C}=Mr(),d=dr(),[R,c]=O.useState(!1),{errorToast:v,successToast:b}=mr();O.useEffect(()=>{},[e,g,a,v]);const _=`https://example.com/lobby/${r}`,f=o||P||!1;(s||L)&&(console.error("Firebase Error:",{groupError:s,usersError:L}),v("データの取得に失敗しました"));const E=(i==null?void 0:i.map(x=>x.avatar))||[],I=async x=>{const U=Er();try{await C(r,x.name,x.avatar,U),sessionStorage.setItem("onlinedraft_user_id",U),d.push(`/draft/${r}`),b("ドラフトに参加しました！")}catch(B){console.error("参加エラー:",B),v(B instanceof Error?B.message:"参加に失敗しました")}},k=x=>{sessionStorage.setItem("onlinedraft_user_id",x),d.push(`/draft/${r}`),b("ドラフトに参加しました！")};return f?u.jsx(te,{bg:"gray.50",minH:"100vh",py:[4,8],children:u.jsx(ne,{maxW:"container.lg",children:u.jsx(pr,{message:"ローディング中..."})})}):u.jsx(Q,{group:l,users:i,roomUrl:_,isAvatarModalOpen:R,usedAvatars:E,onJoinClick:()=>c(!0),onUserSelect:k,onAvatarModalClose:()=>c(!1),onJoinConfirm:I})};try{Q.displayName="LobbyPageInner",Q.__docgenInfo={description:`ロビー画面Innerコンポーネント（Presenter）
UI描画のみを担当、propsでデータとハンドラーを受け取る
Firebaseやビジネスロジックには依存しない純粋なUIコンポーネント`,displayName:"LobbyPageInner",props:{group:{defaultValue:null,description:"",name:"group",required:!0,type:{name:"GroupDataType | null"}},users:{defaultValue:null,description:"",name:"users",required:!0,type:{name:"UserDataType[] | null"}},roomUrl:{defaultValue:null,description:"",name:"roomUrl",required:!0,type:{name:"string"}},isAvatarModalOpen:{defaultValue:null,description:"",name:"isAvatarModalOpen",required:!0,type:{name:"boolean"}},usedAvatars:{defaultValue:null,description:"",name:"usedAvatars",required:!0,type:{name:"string[]"}},onJoinClick:{defaultValue:null,description:"",name:"onJoinClick",required:!0,type:{name:"() => void"}},onUserSelect:{defaultValue:null,description:"",name:"onUserSelect",required:!0,type:{name:"(userId: string) => void"}},onAvatarModalClose:{defaultValue:null,description:"",name:"onAvatarModalClose",required:!0,type:{name:"() => void"}},onJoinConfirm:{defaultValue:null,description:"",name:"onJoinConfirm",required:!0,type:{name:"(userData: { name: string; avatar: string; }) => void"}}}}}catch{}try{Le.displayName="LobbyPage",Le.__docgenInfo={description:`ロビー画面コンポーネント（Container）
ロジック・データ取得・認証のみを担当
LobbyPageInnerにpropsを渡すのみ`,displayName:"LobbyPage",props:{groupId:{defaultValue:null,description:"",name:"groupId",required:!0,type:{name:"string"}}}}}catch{}const Eo={title:"features/lobby/LobbyPage",component:Q,parameters:{layout:"fullscreen"}},Ve={groupName:"2024年プロ野球ドラフト",createdAt:new Date("2024-06-17T10:00:00Z"),updatedAt:new Date("2024-06-17T10:00:00Z"),status:"waiting",maxParticipants:8},jr=[{userId:"user1",userName:"たろう",groupId:"group123",avatar:"1",joinedAt:T.fromDate(new Date("2024-06-17T10:00:00Z")),updatedAt:T.fromDate(new Date("2024-06-17T10:00:00Z")),isActive:!0},{userId:"user2",userName:"はなこ",groupId:"group123",avatar:"2",joinedAt:T.fromDate(new Date("2024-06-17T10:05:00Z")),updatedAt:T.fromDate(new Date("2024-06-17T10:05:00Z")),isActive:!0},{userId:"user3",userName:"じろう",groupId:"group123",avatar:"3",joinedAt:T.fromDate(new Date("2024-06-17T10:10:00Z")),updatedAt:T.fromDate(new Date("2024-06-17T10:10:00Z")),isActive:!1}],N={args:{group:Ve,users:jr,roomUrl:"https://onlinedraft.com/lobby/abc123",loading:!1,isAvatarModalOpen:!1,usedAvatars:["1","2","3"],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}},V={args:{group:null,users:null,roomUrl:"",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>{},onLeaveRoom:()=>{},onAvatarModalClose:()=>{},onJoinConfirm:()=>{}}},H={args:{group:{...Ve,groupName:"新規作成ルーム"},users:[],roomUrl:"https://onlinedraft.com/lobby/newroom123",loading:!1,isAvatarModalOpen:!1,usedAvatars:[],onJoinClick:()=>console.log("Join clicked"),onLeaveRoom:()=>console.log("Leave room clicked"),onAvatarModalClose:()=>console.log("Avatar modal closed"),onJoinConfirm:r=>console.log("Join confirmed:",r)}};var Re,Ee,Fe,Me,je;N.parameters={...N.parameters,docs:{...(Re=N.parameters)==null?void 0:Re.docs,source:{originalSource:`{
  args: {
    group: mockGroup,
    users: mockUsers,
    roomUrl: 'https://onlinedraft.com/lobby/abc123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: ['1', '2', '3'],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Fe=(Ee=N.parameters)==null?void 0:Ee.docs)==null?void 0:Fe.source},description:{story:`基本のロビーページ表示（3人参加）
Firebaseロジックを含まない純粋なUIテスト`,...(je=(Me=N.parameters)==null?void 0:Me.docs)==null?void 0:je.description}}};var we,xe,qe,Pe,Ie;V.parameters={...V.parameters,docs:{...(we=V.parameters)==null?void 0:we.docs,source:{originalSource:`{
  args: {
    group: null,
    users: null,
    roomUrl: '',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => {},
    onLeaveRoom: () => {},
    onAvatarModalClose: () => {},
    onJoinConfirm: () => {}
  }
}`,...(qe=(xe=V.parameters)==null?void 0:xe.docs)==null?void 0:qe.source},description:{story:"ルームが見つからない状態",...(Ie=(Pe=V.parameters)==null?void 0:Pe.docs)==null?void 0:Ie.description}}};var Ue,Oe,Se,Te,Be;H.parameters={...H.parameters,docs:{...(Ue=H.parameters)==null?void 0:Ue.docs,source:{originalSource:`{
  args: {
    group: {
      ...mockGroup,
      groupName: '新規作成ルーム'
    },
    users: [],
    roomUrl: 'https://onlinedraft.com/lobby/newroom123',
    loading: false,
    isAvatarModalOpen: false,
    usedAvatars: [],
    onJoinClick: () => console.log('Join clicked'),
    onLeaveRoom: () => console.log('Leave room clicked'),
    onAvatarModalClose: () => console.log('Avatar modal closed'),
    onJoinConfirm: (userData: {
      name: string;
      avatar: string;
    }) => console.log('Join confirmed:', userData)
  }
}`,...(Se=(Oe=H.parameters)==null?void 0:Oe.docs)==null?void 0:Se.source},description:{story:"参加者なし（新規ルーム）",...(Be=(Te=H.parameters)==null?void 0:Te.docs)==null?void 0:Be.description}}};const Fo=["Basic","RoomNotFound","EmptyRoom"];export{N as Basic,H as EmptyRoom,V as RoomNotFound,Fo as __namedExportsOrder,Eo as default};
