import{j as o}from"./stack-C7hvTRfV.js";import{g as C,e as j,u as A,s as E}from"./states-Bd1A8IJM.js";import{R as B}from"./responsive-modal-COX6Whib.js";import{r as p}from"./index-BXymfbzT.js";import{a as I}from"./useModal-IzikcFvB.js";import{S as V,m as w}from"./index-LBKxmenO.js";import{V as x}from"./v-stack-3HiezQxF.js";import{B as M}from"./box-DfzLPJuh.js";import{T as h}from"./text-CD52-QEU.js";import{u as g,b as D}from"./react-BSHoCbAh.js";const N=w(M),k=D(a=>{const d=a(A),i=a(E),{round:n}=a(C),m=n-1,l=i.filter(e=>e.round===m),c=l.reduce((e,t)=>(e[t.item]||(e[t.item]=[]),e[t.item].push(t),e),{}),r=new Set;return Object.values(c).forEach(e=>{if(e.length>1){const t=Math.max(...e.map(s=>s.randomNumber));e.forEach(s=>{s.randomNumber!==t&&r.add(s.userId)})}}),d.map(e=>{const t=l.find(s=>s.userId===e.id);return{id:e.id,name:e.name,avatar:e.avatar,choice:(t==null?void 0:t.item)||"選択中...",willLose:r.has(e.id)}})}),S=()=>I(["card","typing","slot"],"card"),y=({isOpen:a,onClose:d,variant:i})=>{const n=g(k),m=g(j),{round:l}=g(C),[c,r]=p.useState(!1),[e,t]=p.useState(!1);p.useEffect(()=>{a?(r(!0),t(!1)):(r(!1),t(!1))},[a]),p.useEffect(()=>{if(a&&c){const v=l-1;if(m.some(u=>u.round===v)){let u=0;const f=n.length;switch(i){case"card":u=f*800+600+500+1e3;break;case"typing":{const _=Math.max(...n.map(R=>R.choice.length));u=f*1e3+_*80+300+1e3;break}case"slot":u=(f-1)*500+3e3+500+1e3;break}const F=setTimeout(()=>{t(!0)},u);return()=>clearTimeout(F)}}},[a,c,i,m,l,n]);const s=()=>{r(!0)},b=()=>{r(!1)};return o.jsx(B,{isOpen:a,onClose:d,title:"開票演出",dialogMaxWidth:"4xl",actions:{cancel:{text:"閉じる",onClick:d}},children:o.jsxs(x,{gap:4,w:"full",children:[o.jsx(V,{variant:i,participants:n,isRevealing:c,onStartReveal:s,onReset:b}),e&&o.jsx(N,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},w:"full",bg:"red.50",border:"2px solid",borderColor:"red.200",borderRadius:"lg",p:4,children:o.jsxs(x,{gap:2,align:"start",children:[o.jsxs(M,{display:"flex",alignItems:"center",gap:2,children:[o.jsx(h,{fontSize:"lg",children:"⚠️"}),o.jsx(h,{fontSize:"md",fontWeight:"bold",color:"red.700",children:"重複指名が発生しました！"})]}),o.jsxs(h,{fontSize:"sm",color:"red.600",lineHeight:"1.5",children:["一覧画面で赤く表示されたドラフト結果から順番に編集してください。",o.jsx("br",{}),"重複指名をすべて編集するまで次のラウンドに進めません。",o.jsx("br",{}),"※重複指名の編集順はランダムに決まります"]})]})})]})})};try{S.displayName="useStageModal",S.__docgenInfo={description:`StageModal用のカスタムフック
汎用useModalWithVariantを利用した軽量実装`,displayName:"useStageModal",props:{}}}catch{}try{y.displayName="StageModal",y.__docgenInfo={description:`開票演出を表示するモーダルコンポーネント
ResponsiveModalを使用して、SP/PCで最適な表示を実現`,displayName:"StageModal",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},onClose:{defaultValue:null,description:"",name:"onClose",required:!0,type:{name:"() => void"}},variant:{defaultValue:null,description:"",name:"variant",required:!0,type:{name:"enum",value:[{value:'"slot"'},{value:'"card"'},{value:'"typing"'}]}}}}}catch{}export{y as S,S as u};
