import{c as v,a as u}from"./index-D_wZMSWw.js";import{j as p,L as h,M as k}from"./index-CXxrkVEp.js";var b=v("avatar").parts("root","image","fallback"),i=b.build(),g=e=>{var a;return((a=e.ids)==null?void 0:a.root)??`avatar:${e.id}`},m=e=>{var a;return((a=e.ids)==null?void 0:a.image)??`avatar:${e.id}:image`},f=e=>{var a;return((a=e.ids)==null?void 0:a.fallback)??`avatar:${e.id}:fallback`},y=e=>e.getById(g(e)),c=e=>e.getById(m(e));function L(e,a){const{state:t,send:r,prop:d,scope:s}=e,o=t.matches("loaded");return{loaded:o,setSrc(l){const n=c(s);n==null||n.setAttribute("src",l)},setLoaded(){r({type:"img.loaded",src:"api"})},setError(){r({type:"img.error",src:"api"})},getRootProps(){return a.element({...i.root.attrs,dir:d("dir"),id:g(s)})},getImageProps(){return a.img({...i.image.attrs,hidden:!o,dir:d("dir"),id:m(s),"data-state":o?"visible":"hidden",onLoad(){r({type:"img.loaded",src:"element"})},onError(){r({type:"img.error",src:"element"})}})},getFallbackProps(){return a.element({...i.fallback.attrs,dir:d("dir"),id:f(s),hidden:o,"data-state":o?"hidden":"visible"})}}}var N=p({initialState(){return"loading"},effects:["trackImageRemoval","trackSrcChange"],on:{"src.change":{target:"loading"},"img.unmount":{target:"error"}},states:{loading:{entry:["checkImageStatus"],on:{"img.loaded":{target:"loaded",actions:["invokeOnLoad"]},"img.error":{target:"error",actions:["invokeOnError"]}}},error:{on:{"img.loaded":{target:"loaded",actions:["invokeOnLoad"]}}},loaded:{on:{"img.error":{target:"error",actions:["invokeOnError"]}}}},implementations:{actions:{invokeOnLoad({prop:e}){var a;(a=e("onStatusChange"))==null||a({status:"loaded"})},invokeOnError({prop:e}){var a;(a=e("onStatusChange"))==null||a({status:"error"})},checkImageStatus({send:e,scope:a}){const t=c(a);if(!(t!=null&&t.complete))return;const r=E(t)?"img.loaded":"img.error";e({type:r,src:"ssr"})}},effects:{trackImageRemoval({send:e,scope:a}){const t=y(a);return k(t,{callback(r){Array.from(r[0].removedNodes).find(o=>o.nodeType===Node.ELEMENT_NODE&&o.matches("[data-scope=avatar][data-part=image]"))&&e({type:"img.unmount"})}})},trackSrcChange({send:e,scope:a}){const t=c(a);return h(t,{attributes:["src","srcset"],callback(){e({type:"src.change"})}})}}}});function E(e){return e.complete&&e.naturalWidth!==0&&e.naturalHeight!==0}u()(["dir","id","ids","onStatusChange","getRootNode"]);export{b as a,L as c,N as m};
