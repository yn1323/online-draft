import{d as g,b as E,u as P,r as v}from"./create-slot-recipe-context-lH_kfrLM.js";import{c as y,N as x,O as S,r as N,F as O,z as U,P as M,G as A}from"./index-5qRv5KYD.js";import{c as h}from"./index-CrjboX4Z.js";import{r as m}from"./index-BXymfbzT.js";import{c as C}from"./factory-B-x4ZR3W.js";import{j as d}from"./create-recipe-context-LbQq3bM7.js";const G=e=>g()(e,["immediate","lazyMount","onExitComplete","present","skipAnimationOnMount","unmountOnExit"]);function T(e,t){const{state:o,send:n,context:i}=e,s=o.matches("mounted","unmountSuspended");return{skip:!i.get("initial"),present:s,setNode(r){r&&n({type:"NODE.SET",node:r})},unmount(){n({type:"UNMOUNT"})}}}var k=y({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,action:t,prop:o}){e([()=>o("present")],()=>{t(["setInitial","syncPresence"])})},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},invokeOnExitComplete:({prop:e})=>{var t;(t=e("onExitComplete"))==null||t()},setNode:({refs:e,event:t})=>{e.set("node",t.node)},setStyles:({refs:e,event:t})=>{e.set("styles",O(t.node))},syncPresence:({context:e,refs:t,send:o,prop:n})=>{const i=n("present");if(i)return o({type:"MOUNT",src:"presence.changed"});const s=t.get("node");if(!i&&(s==null?void 0:s.ownerDocument.visibilityState)==="hidden")return o({type:"UNMOUNT",src:"visibilitychange"});N(()=>{var u,c;const r=p(t.get("styles"));e.set("unmountAnimationName",r),r==="none"||r===e.get("prevAnimationName")||((u=t.get("styles"))==null?void 0:u.display)==="none"||((c=t.get("styles"))==null?void 0:c.animationDuration)==="0s"?o({type:"UNMOUNT",src:"presence.changed"}):o({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{N(()=>{e.set("prevAnimationName",p(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:o})=>{const n=t.get("node");if(!n)return;const i=u=>{var a,l;(((l=(a=u.composedPath)==null?void 0:a.call(u))==null?void 0:l[0])??u.target)===n&&e.set("prevAnimationName",p(t.get("styles")))},s=u=>{const c=p(t.get("styles"));U(u)===n&&c===e.get("unmountAnimationName")&&o({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",i),n.addEventListener("animationcancel",s),n.addEventListener("animationend",s);const r=x(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",i),n.removeEventListener("animationcancel",s),n.removeEventListener("animationend",s),S(()=>r())}}}}});function p(e){return(e==null?void 0:e.animationName)||"none"}h()(["onExitComplete","present","immediate"]);function D(e,t={}){const{sync:o=!1}=t,n=L(e);return m.useCallback((...i)=>{var s;return o?queueMicrotask(()=>{var r;return(r=n.current)==null?void 0:r.call(n,...i)}):(s=n.current)==null?void 0:s.call(n,...i)},[o,n])}function L(e){const t=m.useRef(e);return t.current=e,t}const _=(e={})=>{const{lazyMount:t,unmountOnExit:o,present:n,skipAnimationOnMount:i=!1,...s}=e,r=m.useRef(!1),u={...s,present:n,onExitComplete:D(e.onExitComplete)},c=E(k,u),a=T(c);a.present&&(r.current=!0);const l=!a.present&&!r.current&&t||o&&!a.present&&r.current,f=()=>({"data-state":a.skip&&i?void 0:n?"open":"closed",hidden:!a.present});return{ref:a.setNode,getPresenceProps:f,present:a.present,unmounted:l}},[B,H]=C({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),J=e=>{var c;const{children:t,disabled:o}=e,[n,i]=m.useState((c=e.container)==null?void 0:c.current),s=m.useSyncExternalStore(j,()=>!1,()=>!0),{getRootNode:r}=P();if(m.useEffect(()=>{i(()=>{var a;return(a=e.container)==null?void 0:a.current})},[e.container]),s||o)return d.jsx(d.Fragment,{children:t});const u=n??w(r);return d.jsx(d.Fragment,{children:m.Children.map(t,a=>v.createPortal(a,u))})},w=e=>{const t=e==null?void 0:e(),o=t.getRootNode();return M(o)?o:A(t).body},j=()=>()=>{};export{B as P,_ as a,J as b,G as s,H as u};
