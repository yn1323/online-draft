# オンラインドラフト会議 開発計画書

## 🎯 開発概要

### プロジェクト目標
Claude Code協働開発により、リアルタイムマルチプレイヤードラフトゲーム「オンラインドラフト会議」を実装する。個人開発×AI協働に最適化された開発プロセスで、効率的で保守性の高いアプリケーションを構築する。

### 開発方針
- **実用性重視**: 過度な抽象化より読みやすさを優先
- **シンプルファースト**: 必要になってから複雑化する
- **Claude Code最適化**: AIとの協働に特化した開発ワークフロー

## 🏗️ 技術スタック・アーキテクチャ

### フロントエンド
- **フレームワーク**: Next.js 15 (App Router)
- **UI フレームワーク**: React 19
- **言語**: TypeScript (strict mode)
- **UI ライブラリ**: Chakra UI v3
- **状態管理**: Jotai
- **アニメーション**: Framer Motion

### バックエンド・インフラ
- **データベース**: Firebase Firestore
- **認証**: Firebase Anonymous Auth
- **ホスティング**: Vercel (推奨)

### 開発・テストツール
- **Linter/Formatter**: Biome
- **テスト**: Vitest (単体), Playwright (E2E)
- **Storybook**: コンポーネント開発・VRT
- **パッケージ管理**: pnpm

## 📅 開発フェーズ・スケジュール

### Phase A: プロジェクト基盤構築・設計 (2-3日)
**目標**: 開発環境整備・デザインシステム・モック作成

**実装チェックリスト**:
- [ ] プロジェクト初期化・依存関係確認
- [ ] Next.js + TypeScript + Chakra UI セットアップ確認
- [ ] Firebase プロジェクト作成・設定
- [ ] **デザインシステム設計**: カラーパレット定義
- [ ] **デザインシステム設計**: タイポグラフィ仕様
- [ ] **デザインシステム設計**: コンポーネント仕様
- [ ] **モック・プロトタイプ作成**: トップページワイヤーフレーム
- [ ] **モック・プロトタイプ作成**: ロビー画面ワイヤーフレーム
- [ ] **モック・プロトタイプ作成**: ドラフト実行画面ワイヤーフレーム
- [ ] 基本ディレクトリ構造作成

**完了条件**:
- [ ] 実行可能な開発環境
- [ ] デザインシステム仕様書完成
- [ ] 画面モック・プロトタイプ完成
- [ ] Firebase接続確認完了

### Phase B: 基盤コンポーネント開発 (2-3日)
**目標**: 再利用可能な基盤コンポーネント構築

**実装チェックリスト**:
- [ ] **基本UIコンポーネント**: Button
- [ ] **基本UIコンポーネント**: Input
- [ ] **基本UIコンポーネント**: Card
- [ ] **基本UIコンポーネント**: Avatar
- [ ] **基本UIコンポーネント**: Toast
- [ ] **レイアウトコンポーネント**: Header
- [ ] **レイアウトコンポーネント**: Container
- [ ] **レイアウトコンポーネント**: Layout
- [ ] Firebase接続カスタムフック
- [ ] Firebase認証カスタムフック
- [ ] Jotai状態管理基盤
- [ ] エラーハンドリングシステム
- [ ] トースト通知システム

**テストチェックリスト**:
- [ ] ButtonコンポーネントStorybook
- [ ] InputコンポーネントStorybook
- [ ] CardコンポーネントStorybook
- [ ] AvatarコンポーネントStorybook
- [ ] Firebase接続フック単体テスト
- [ ] 状態管理基盤単体テスト

**完了条件**:
- [ ] 完全なコンポーネントライブラリ
- [ ] Storybookでの動作確認
- [ ] 基盤システムの単体テスト完了

### Phase C: 機能実装フェーズ1 - 基本フロー (3-4日)
**目標**: ルーム作成からドラフト開始まで

**実装チェックリスト**:
- [ ] **トップページ**: ルーム作成機能
- [ ] **トップページ**: ルーム参加機能
- [ ] **トップページ**: UI実装
- [ ] **ロビー画面**: 参加者一覧表示
- [ ] **ロビー画面**: URL共有機能
- [ ] **ロビー画面**: ドラフト開始機能
- [ ] **アバター選択機能**: アバター選択UI
- [ ] **アバター選択機能**: 選択状態管理
- [ ] **Firebase Firestore**: groupコレクション実装
- [ ] **Firebase Firestore**: userコレクション実装
- [ ] **リアルタイム同期**: 参加者リスト同期
- [ ] **リアルタイム同期**: ルーム状態同期

**テストチェックリスト**:
- [ ] トップページE2Eテスト (ルーム作成)
- [ ] トップページE2Eテスト (ルーム参加)
- [ ] ロビー画面E2Eテスト (参加者表示)
- [ ] ロビー画面E2Eテスト (開始操作)
- [ ] トップページVRT (PC)
- [ ] トップページVRT (SP)
- [ ] ロビー画面VRT (PC)
- [ ] ロビー画面VRT (SP)
- [ ] Firestoreデータモデル単体テスト
- [ ] リアルタイム同期フック単体テスト

**完了条件**:
- [ ] ルーム作成→参加→開始の基本フロー動作
- [ ] 複数ユーザーでのリアルタイム同期確認
- [ ] 基本フローのテストスイート完了

### Phase D: 機能実装フェーズ2 - ドラフト実行 (4-5日)
**目標**: メインのドラフトゲーム機能完成

**実装チェックリスト**:
- [ ] **ドラフト実行画面**: SPレイアウト実装
- [ ] **ドラフト実行画面**: PCレイアウト実装
- [ ] **ドラフト実行画面**: レスポンシブ対応
- [ ] **選択入力機能**: アイテム名入力
- [ ] **選択入力機能**: コメント入力
- [ ] **選択入力機能**: 送信処理
- [ ] **競合検出アルゴリズム**: 同一アイテム検出
- [ ] **競合解決アルゴリズム**: ランダム勝者決定
- [ ] **競合解決アルゴリズム**: 再選択処理
- [ ] **開票演出**: スロット風アニメーション
- [ ] **開票演出**: 結果表示
- [ ] **チャット機能**: メッセージ送信
- [ ] **チャット機能**: ログ表示
- [ ] **取得済みリスト**: 参加者別表示
- [ ] **取得済みリスト**: アコーディオン/カード表示
- [ ] **Firebase Firestore**: selectionコレクション実装
- [ ] **リアルタイム同期**: 選択状況同期
- [ ] **リアルタイム同期**: チャット同期

**テストチェックリスト**:
- [ ] ドラフト実行画面E2Eテスト (選択入力)
- [ ] ドラフト実行画面E2Eテスト (開票演出)
- [ ] ドラフト実行画面E2Eテスト (競合処理)
- [ ] ドラフト実行画面E2Eテスト (チャット)
- [ ] ドラフト実行画面VRT (PC)
- [ ] ドラフト実行画面VRT (SP)
- [ ] 競合解決アルゴリズム単体テスト
- [ ] 開票演出コンポーネント単体テスト
- [ ] selectionデータモデル単体テスト

**完了条件**:
- [ ] 完全なドラフトゲーム体験
- [ ] 複数巡目対応・競合処理動作確認
- [ ] 全機能のテストスイート完了

### Phase E: 最適化・仕上げ (2-3日)
**目標**: パフォーマンス最適化・UI/UX調整

**実装チェックリスト**:
- [ ] **パフォーマンス最適化**: コンポーネント再レンダリング最適化
- [ ] **パフォーマンス最適化**: Firestoreクエリ最適化
- [ ] **パフォーマンス最適化**: リアルタイム同期最適化
- [ ] **レスポンシブデザイン**: SP表示最終調整
- [ ] **レスポンシブデザイン**: PC表示最終調整
- [ ] **アニメーション**: 開票演出微調整
- [ ] **アニメーション**: ボタン押下感調整
- [ ] **エラーハンドリング**: 接続エラー対応強化
- [ ] **エラーハンドリング**: バリデーションエラー強化
- [ ] **アクセシビリティ**: 基本的なaria-label追加
- [ ] **アクセシビリティ**: キーボードナビゲーション確認

**テスト・品質チェックリスト**:
- [ ] パフォーマンステスト実行
- [ ] 全E2Eテスト安定性確認
- [ ] 全VRT差分確認・承認
- [ ] クロスブラウザ動作確認
- [ ] モバイル実機動作確認

**完了条件**:
- [ ] 最適化されたパフォーマンス
- [ ] 完成度の高いUI/UX
- [ ] 全テスト成功の安定システム

### Phase F: デプロイ・運用準備 (1-2日)
**目標**: 本番環境デプロイ・運用開始

**実装チェックリスト**:
- [ ] **本番環境設定**: Vercel プロジェクト作成
- [ ] **本番環境設定**: Firebase 本番プロジェクト設定
- [ ] **本番環境設定**: 環境変数設定
- [ ] **セキュリティ設定**: Firebase セキュリティルール
- [ ] **セキュリティ設定**: CORS設定
- [ ] **最終テスト**: 本番環境での動作確認
- [ ] **最終テスト**: 複数ユーザー接続テスト
- [ ] **ドキュメント**: README更新
- [ ] **ドキュメント**: 運用手順書作成
- [ ] **モニタリング**: エラー監視設定

**完了条件**:
- [ ] 本番稼働システム
- [ ] 完全な運用ドキュメント
- [ ] 継続開発可能な状態

## 🎯 実装優先度・依存関係

### 最優先 (Phase A)
1. **デザインシステム設計**: 全UI開発の基盤
2. **モック・プロトタイプ**: 開発方向性の確定
3. **Firebase 接続・認証**: すべての機能の基盤
4. **開発環境確認**: 効率的な開発のための基盤

### 高優先 (Phase B-C)
1. **基本UIコンポーネント**: 全画面で必要
2. **ルーム管理**: ドラフト機能の前提
3. **リアルタイム同期**: コア機能
4. **基本フローテスト**: 品質保証の基盤

### 高優先 (Phase D)
1. **ドラフト実行ロジック**: メイン機能
2. **競合解決アルゴリズム**: ゲームの核心
3. **開票演出**: ユーザー体験の要
4. **レスポンシブ対応**: 必須要件

### 中優先 (Phase E)
1. **パフォーマンス最適化**: ユーザー体験向上
2. **UI/UX仕上げ**: 完成度向上
3. **エラーハンドリング強化**: 安定性向上

### 低優先 (Phase F)
1. **本番環境設定**: デプロイ準備
2. **ドキュメント整備**: 保守性
3. **運用監視設定**: 継続運用

## 🧪 テスト・品質保証計画

### テスト戦略 (機能実装と同時実施)
- **E2Eテスト**: ハッピーパス重視 (比重 5:1) - 各機能実装と同時作成
- **単体テスト**: 重要ロジックのみ - コンポーネント・フック実装と同時作成
- **VRT**: PC・SP両対応、ライトモードのみ - Storybook作成と同時実施
- **Storybookテスト**: 全コンポーネント必須 - コンポーネント実装と同時作成

### 品質基準
- **TypeScript**: strict mode エラーゼロ
- **Linter**: Biome ルール完全準拠
- **テストカバレッジ**: 重要ロジック 100%
- **E2E安定性**: 基本フロー成功率 100%

### 継続的品質管理
- **開発中**: 機能実装完了時点でテスト完了
- **PR毎**: Lint, TypeCheck, Test実行
- **デプロイ前**: 全テストスイート実行
- **コミット前**: 手動での基本動作確認

### フェーズ別テスト方針
- **Phase B**: コンポーネント単体テスト + Storybook
- **Phase C**: 基本フローE2E + 画面VRT
- **Phase D**: ドラフト機能E2E + 複雑UI VRT
- **Phase E**: パフォーマンステスト + 統合テスト

## ⚠️ リスク管理・課題対応

### 技術リスク
**Firebase接続不安定**:
- 対策: 適切なエラーハンドリング・再接続ロジック
- 影響: 中・回避可能

**リアルタイム同期の複雑さ**:
- 対策: シンプルなデータ構造・段階的実装
- 影響: 高・要注意

**レスポンシブ対応の工数増加**:
- 対策: Chakra UIの活用・2段階ブレイクポイント
- 影響: 中・管理可能

### 開発リスク
**機能要件の複雑化**:
- 対策: MVP重視・段階的機能追加
- 影響: 中・管理可能

**パフォーマンス問題**:
- 対策: 早期のパフォーマンステスト・最適化
- 影響: 低・対応可能

### 対応方針
1. **シンプル実装優先**: 複雑化は必要になってから
2. **段階的開発**: 動くものから順次改善
3. **継続的テスト**: 早期の問題発見・修正
4. **Claude Code活用**: 効率的な開発・コードレビュー

## 🔧 開発環境・ツール設定

### 必須コマンド
```bash
# 開発開始
pnpm dev

# 品質チェック (コミット前必須)
pnpm lint          # Biome linting
pnpm type-check    # TypeScript 型チェック
pnpm test          # Vitest 単体テスト

# E2E・VRT
pnpm e2e           # Playwright E2E
pnpm storybook     # Storybook開発
pnpm storybook:test-ci  # VRT実行
```

### 開発ワークフロー
```
1. 📋 Explore  - 既存コード理解・要件確認
2. 📝 Plan     - 実装方針策定・TODO作成
3. 💻 Code     - 具体的実装作業
4. 🔄 Commit   - テスト・lint実行・コミット
```

## 📊 進捗管理・評価指標

### マイルストーン
- **Phase A完了**: 開発環境構築完了
- **Phase C完了**: 基本フロー動作確認
- **Phase D完了**: フル機能動作確認
- **Phase F完了**: 本番リリース

### 成功指標
- **機能完成度**: 要件定義の全機能実装
- **品質**: テスト成功率 100%
- **パフォーマンス**: 基本操作の応答性
- **保守性**: Claude Code での継続開発可能性

## 🚀 次のステップ

開発計画策定完了後の具体的なアクション:

1. **Phase A開始**: プロジェクト基盤構築・設計
2. **デザインシステム設計**: カラーパレット・コンポーネント仕様策定
3. **モック・プロトタイプ作成**: 主要画面の動作確認用モック
4. **Firebase設定**: プロジェクト作成・認証設定
5. **環境確認**: 開発環境・ツール動作確認

---

*この開発計画書は、プロジェクトの進行とともに継続的に更新・改善されます。*
*最終更新: 2025年6月*