# E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚¬ã‚¤ãƒ‰

## ğŸ¯ æ¦‚è¦

OnlineDraftã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®E2Eï¼ˆEnd-to-Endï¼‰ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¨ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

### ãƒ†ã‚¹ãƒˆç¨®åˆ¥
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ** / **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ãƒ†ã‚¹ãƒˆ**
- å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œãƒ•ãƒ­ãƒ¼ã‚’æ¨¡æ“¬ã—ãŸEnd-to-Endãƒ†ã‚¹ãƒˆ
- æŠ€è¡“çš„ãªæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã§ã¯ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
e2e/
â”œâ”€â”€ tests/                          # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆassertionä¸­å¿ƒï¼‰
â”‚   â”œâ”€â”€ organizer-journey.test.ts   # ä¸»å‚¬è€…ã‚·ãƒŠãƒªã‚ª
â”‚   â”œâ”€â”€ participant-journey.test.ts # å‚åŠ è€…ã‚·ãƒŠãƒªã‚ª  
â”‚   â”œâ”€â”€ returning-user.test.ts      # å±¥æ­´ã‹ã‚‰ã®å‚åŠ 
â”‚   â”œâ”€â”€ multi-user-collaboration.test.ts # è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å”åƒ
â”‚   â””â”€â”€ error-scenarios.test.ts     # ã‚¨ãƒ©ãƒ¼é­é‡ã‚·ãƒŠãƒªã‚ª
â”œâ”€â”€ operations/                     # è¤‡é›‘ãªæ“ä½œæ‰‹é †ï¼ˆActionå±¤ï¼‰
â”‚   â”œâ”€â”€ draft-operations.ts         # ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆãƒ»å‚åŠ æ“ä½œ
â”‚   â”œâ”€â”€ user-operations.ts          # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆãƒ»é¸æŠæ“ä½œ
â”‚   â””â”€â”€ navigation-operations.ts    # ç”»é¢é·ç§»æ“ä½œ
â”œâ”€â”€ utils/                          # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ selectors.ts                # data-testidå®šç¾©
â”‚   â””â”€â”€ test-data.ts                # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â””â”€â”€ setup/
    â””â”€â”€ global-setup.ts
```

### ğŸ“‹ è¨­è¨ˆåŸå‰‡

#### è²¬å‹™åˆ†é›¢
- **tests/**: assertionï¼ˆæœŸå¾…çµæœã®æ¤œè¨¼ï¼‰ã¨ç°¡å˜ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- **operations/**: è¤‡é›‘ãªæ“ä½œæ‰‹é †ã®æŠ½è±¡åŒ–
- **utils/**: å…±é€šãƒ‡ãƒ¼ã‚¿ã¨è¨­å®š

#### ã‚³ãƒ¼ãƒ‰æ§‹é€ 
```typescript
// tests/ ã§ã®operationså‘¼ã³å‡ºã—ä¾‹
test('ä¸»å‚¬è€…ãŒãƒ‰ãƒ©ãƒ•ãƒˆã‚’ä½œæˆ', async ({ page }) => {
  // Action: operationså±¤ã§è¤‡é›‘ãªæ‰‹é †ã‚’å®Ÿè¡Œ
  const groupId = await draftOps.createNewDraft(page);
  await userOps.createUser(page, 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å', 1);
  
  // Assertion: testså±¤ã§æœŸå¾…çµæœã‚’æ¤œè¨¼
  await expect(page.getByText('ãƒ¦ãƒ¼ã‚¶ãƒ¼å')).toBeVisible();
  await expect(page.locator('[data-testid="group-code"]')).toContainText(groupId);
});
```

## ğŸ¬ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªè¨­è¨ˆ

### ç¾åœ¨ã®å®Ÿè£…å¯¾è±¡ãƒ•ãƒ­ãƒ¼

#### 1. ä¸»å‚¬è€…ã‚·ãƒŠãƒªã‚ªï¼ˆorganizer-journey.test.tsï¼‰
```
TOPãƒšãƒ¼ã‚¸ â†’ ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆãƒœã‚¿ãƒ³ â†’ Firebaseè‡ªå‹•èªè¨¼ â†’ Firestoreã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ â†’ ãƒ­ãƒ“ãƒ¼ãƒšãƒ¼ã‚¸ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
```

**ãƒ†ã‚¹ãƒˆå†…å®¹:**
- ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆã‹ã‚‰ãƒ­ãƒ“ãƒ¼åˆ°é”
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨ã‚¢ãƒã‚¿ãƒ¼é¸æŠ
- æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºç¢ºèª
- å‚åŠ è€…å¾…æ©Ÿç”»é¢ã®è¡¨ç¤º

#### 2. å‚åŠ è€…ã‚·ãƒŠãƒªã‚ªï¼ˆparticipant-journey.test.tsï¼‰
```
A. ã‚³ãƒ¼ãƒ‰å‚åŠ : TOPãƒšãƒ¼ã‚¸ â†’ å‚åŠ ãƒœã‚¿ãƒ³ â†’ å‚åŠ ãƒšãƒ¼ã‚¸ â†’ ã‚³ãƒ¼ãƒ‰å…¥åŠ› â†’ ãƒ­ãƒ“ãƒ¼ãƒšãƒ¼ã‚¸
B. URLå‚åŠ :   TOPãƒšãƒ¼ã‚¸ â†’ å‚åŠ ãƒœã‚¿ãƒ³ â†’ å‚åŠ ãƒšãƒ¼ã‚¸ â†’ URLå…¥åŠ› â†’ ãƒ­ãƒ“ãƒ¼ãƒšãƒ¼ã‚¸  
C. å±¥æ­´å‚åŠ :  TOPãƒšãƒ¼ã‚¸ â†’ å‚åŠ ãƒœã‚¿ãƒ³ â†’ å‚åŠ ãƒšãƒ¼ã‚¸ â†’ å±¥æ­´é¸æŠ â†’ ãƒ­ãƒ“ãƒ¼ãƒšãƒ¼ã‚¸
```

**ãƒ†ã‚¹ãƒˆå†…å®¹:**
- 3ç¨®é¡ã®å‚åŠ æ–¹æ³•ã™ã¹ã¦
- å‚åŠ å¾Œã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
- æ—¢å­˜å‚åŠ è€…ã¨ã®åŒæœŸç¢ºèª

#### 3. è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼å”åƒï¼ˆmulti-user-collaboration.test.tsï¼‰
```
ä¸»å‚¬è€…ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆ â† å‚åŠ è€…Aå‚åŠ  â† å‚åŠ è€…Bå‚åŠ  â†’ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸç¢ºèª
```

**ãƒ†ã‚¹ãƒˆå†…å®¹:**
- è¤‡æ•°ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã§ã®åŒæ™‚å‚åŠ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åæ˜ 
- 3äººä»¥ä¸Šã§ã®å”åƒå‹•ä½œ

#### 4. å±¥æ­´ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆreturning-user.test.tsï¼‰
```
å‚åŠ ãƒšãƒ¼ã‚¸ â†’ å±¥æ­´ä¸€è¦§è¡¨ç¤º â†’ éå»ã®ãƒ‰ãƒ©ãƒ•ãƒˆé¸æŠ â†’ ãƒ­ãƒ“ãƒ¼å‚åŠ 
```

**ãƒ†ã‚¹ãƒˆå†…å®¹:**
- å‚åŠ å±¥æ­´ã®è¡¨ç¤º
- å±¥æ­´ã‹ã‚‰ã®ç´ æ—©ã„å†å‚åŠ 
- å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§

#### 5. ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼ˆerror-scenarios.test.tsï¼‰
```
A. ç„¡åŠ¹ã‚³ãƒ¼ãƒ‰:   å‚åŠ ãƒšãƒ¼ã‚¸ â†’ å­˜åœ¨ã—ãªã„ã‚³ãƒ¼ãƒ‰å…¥åŠ› â†’ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
B. ãƒ¦ãƒ¼ã‚¶ãƒ¼é‡è¤‡: ãƒ­ãƒ“ãƒ¼ãƒšãƒ¼ã‚¸ â†’ æ—¢å­˜ã¨åŒåä½œæˆè©¦è¡Œ â†’ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
C. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: Firebaseæ¥ç¶šå¤±æ•— â†’ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¢ºèª
```

**ãƒ†ã‚¹ãƒˆå†…å®¹:**
- å„ç¨®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã§ã®é©åˆ‡ãªé€šçŸ¥
- ã‚¨ãƒ©ãƒ¼å¾Œã®å›å¾©ãƒ•ãƒ­ãƒ¼
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®ç¢ºèª

## ğŸ›  æŠ€è¡“å®Ÿè£…æ–¹é‡

### ä½¿ç”¨æŠ€è¡“
- **Playwright**: æ—¢å­˜è¨­å®šã‚’æ´»ç”¨
- **Firebase Emulator**: ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ç‹¬ç«‹å®Ÿè¡Œ
- **MSW**: Storybooké€£æºã®APIãƒ¢ãƒƒã‚¯æ´»ç”¨
- **data-testid**: ç¢ºå®Ÿã§ä¿å®ˆæ€§ã®é«˜ã„è¦ç´ é¸æŠ

### Firebaseé€£æºãƒ†ã‚¹ãƒˆ
```typescript
// Firebase Emulatorä½¿ç”¨ä¾‹
test.beforeAll(async () => {
  // Firebase Emulatorèµ·å‹•
  await exec('firebase emulators:start --only firestore,auth');
});

// å®Ÿéš›ã®Firestoreæ“ä½œã‚’ãƒ†ã‚¹ãƒˆ
const groupId = await draftOps.createNewDraft(page);
// â†’ å®Ÿéš›ã«Firestoreã«ãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚Œã‚‹
```

### Page Object Patternæ´»ç”¨
```typescript
// operations/draft-operations.ts
export class DraftOperations {
  async createNewDraft(page: Page): Promise<string> {
    await page.goto('/');
    await page.click('[data-testid="create-draft-button"]');
    await page.waitForURL('/lobby/*');
    
    // URLã‹ã‚‰groupIdã‚’æŠ½å‡º
    return page.url().split('/lobby/')[1];
  }

  async joinByCode(page: Page, code: string): Promise<void> {
    await page.fill('[data-testid="meeting-input"]', code);
    await page.click('[data-testid="join-button"]');
    await page.waitForURL(`/lobby/${code}`);
  }
}
```

### å…±é€šã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ç®¡ç†
```typescript
// utils/selectors.ts
export const SELECTORS = {
  // TOPãƒšãƒ¼ã‚¸
  CREATE_DRAFT_BUTTON: '[data-testid="create-draft-button"]',
  JOIN_DRAFT_BUTTON: '[data-testid="join-draft-button"]',
  
  // å‚åŠ ãƒšãƒ¼ã‚¸
  MEETING_INPUT: '[data-testid="meeting-input"]',
  JOIN_BUTTON: '[data-testid="join-button"]',
  
  // ãƒ­ãƒ“ãƒ¼ãƒšãƒ¼ã‚¸
  USER_NAME_INPUT: '[data-testid="user-name-input"]',
  SUBMIT_USER_BUTTON: '[data-testid="submit-user-button"]',
  GROUP_CODE: '[data-testid="group-code"]',
  
  // ã‚¢ãƒã‚¿ãƒ¼
  AVATAR: (id: number) => `[data-testid="avatar-${id}"]`,
} as const;
```

## ğŸ“Š å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: åŸºæœ¬ãƒ•ãƒ­ãƒ¼ï¼ˆWeek 1-2ï¼‰
1. **organizer-journey**: ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼
2. **participant-journey**: ã‚³ãƒ¼ãƒ‰å‚åŠ ãƒ•ãƒ­ãƒ¼
3. **operations/**: åŸºæœ¬çš„ãªæ“ä½œæŠ½è±¡åŒ–

### Phase 2: å”åƒãƒ»å±¥æ­´ï¼ˆWeek 3ï¼‰
1. **multi-user-collaboration**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
2. **returning-user**: å±¥æ­´æ©Ÿèƒ½
3. **URLãƒ»å±¥æ­´å‚åŠ **: å‚åŠ æ–¹æ³•ã®æ‹¡å¼µ

### Phase 3: ã‚¨ãƒ©ãƒ¼ãƒ»å …ç‰¢æ€§ï¼ˆWeek 4ï¼‰
1. **error-scenarios**: å„ç¨®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹
2. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éšœå®³**: æ¥ç¶šå¤±æ•—æ™‚ã®å‹•ä½œ
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§é‡ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ

## ğŸ”§ é–‹ç™ºãƒ»å®Ÿè¡Œç’°å¢ƒ

### å¿…è¦ãªã‚³ãƒãƒ³ãƒ‰
```bash
# E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pnpm test:e2e

# Firebase Emulatorèµ·å‹•
firebase emulators:start --only firestore,auth

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆãƒ†ã‚¹ãƒˆå¯¾è±¡ï¼‰
pnpm dev

# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆ
pnpm test:e2e:headless
```

### CI/CDé€£æº
- GitHub Actionsã§ã®è‡ªå‹•å®Ÿè¡Œ
- Firebase Emulatorè‡ªå‹•èµ·å‹•
- ãƒ†ã‚¹ãƒˆçµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜
- å¤±æ•—æ™‚ã®å‹•ç”»è¨˜éŒ²

## ğŸ“ˆ å“è³ªæŒ‡æ¨™

### ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- **ä¸»è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼**: 100%ã‚«ãƒãƒ¼
- **ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹**: ä¸»è¦ãƒ‘ã‚¿ãƒ¼ãƒ³90%
- **ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ**: Chrome, Firefox, Safari

### å®Ÿè¡Œæ™‚é–“ç›®æ¨™
- **å˜ä¸€ã‚·ãƒŠãƒªã‚ª**: 30ç§’ä»¥å†…
- **å…¨ã‚·ãƒŠãƒªã‚ª**: 5åˆ†ä»¥å†…
- **CIå®Ÿè¡Œ**: 10åˆ†ä»¥å†…ï¼ˆä¸¦åˆ—å®Ÿè¡Œå«ã‚€ï¼‰

### ä¿å®ˆæ€§
- **data-testid**: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å…¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–è¦ç´ 
- **operationsæŠ½è±¡åŒ–**: UIå¤‰æ›´æ™‚ã®ä¿®æ­£ç®‡æ‰€æœ€å°åŒ–
- **å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤

---

**æœ€çµ‚æ›´æ–°**: 2025/1/7 - E2Eãƒ†ã‚¹ãƒˆæˆ¦ç•¥ç­–å®šå®Œäº†