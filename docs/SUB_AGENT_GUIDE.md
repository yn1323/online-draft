# サブエージェント並列実行ガイド (/sub コマンド)

## 概要

`/sub` コマンドは、指定されたタスクを独立したサブエージェントとして並列実行するカスタムコマンドです。複数のタスクを同時に処理することで、開発効率を大幅に向上させることができます。

## 基本構文

```bash
/sub <タスク内容>
```

## 主な特徴

### 🔄 並列実行
- 複数のサブエージェントを同時に起動可能
- それぞれが独立してタスクを実行
- メインワークフローを停止せずに処理

### 🎯 自律動作
- サブエージェントは与えられたタスクを自律的に実行
- プロジェクトコンテキストを自動で理解
- 必要に応じてツールを選択して使用

### 📊 結果統合
- 各サブエージェントの結果を収集
- メインワークフローに統合
- 完了状況の一元管理

## 使用例

### 単一タスク実行
```bash
/sub DraftPageのlintエラーを修正
```

### 複数タスク同時実行
```bash
/sub useSessionUserのテストカバレッジを向上
/sub ドキュメントを最新の実装に合わせて更新
/sub 認証エラーハンドリングを改善
```

### 具体的なタスク例

#### バグ修正系
```bash
/sub TypeScriptエラーを修正
/sub ESLintの警告を解決
/sub テストの失敗を修正
```

#### 機能改善系
```bash
/sub パフォーマンスを最適化
/sub ユーザビリティを向上
/sub アクセシビリティ対応
```

#### ドキュメント系
```bash
/sub READMEを更新
/sub APIドキュメントを作成
/sub コメントを充実
```

#### テスト系
```bash
/sub ユニットテストを追加
/sub E2Eテストを強化
/sub テストカバレッジを向上
```

## ベストプラクティス

### ✅ 効果的なタスク記述

**Good:**
- `/sub useFirebaseAuthフックの型安全性を向上`
- `/sub DraftAuthGuardコンポーネントのエラーハンドリング強化`
- `/sub SessionStorageヘルパーのテストケース追加`

**Avoid:**
- `/sub なんか直して` (曖昧すぎる)
- `/sub 全部やって` (範囲が広すぎる)
- `/sub チェックして` (アクションが不明確)

### 📋 タスクの分割指針

1. **単一責任**: 1つのサブエージェントは1つの明確な責任を持つ
2. **独立性**: 他のサブエージェントの結果に依存しない
3. **適切なスコープ**: 30分〜2時間程度で完了可能な範囲

### 🔍 実行監視

サブエージェント実行中は以下を監視：
- 各エージェントの進捗状況
- エラーの発生状況
- リソース使用状況

## 制約事項

### システムリソース
- 同時実行数はシステムリソースを考慮
- メモリ使用量の監視
- CPU負荷の分散

### タスクの独立性
- サブエージェント間でのファイル競合回避
- Git操作の重複防止
- データベース操作の整合性確保

### エラーハンドリング
- サブエージェントの失敗時の対応
- 部分的失敗時の処理継続
- ロールバック機能

## 実装詳細

### 内部処理フロー

1. **タスク検証**: 入力されたタスクの妥当性確認
2. **スコープ分析**: タスクの複雑さと要求リソース分析  
3. **コンテキスト準備**: プロジェクト情報の収集
4. **サブエージェント起動**: Task toolを使用して独立実行
5. **進捗監視**: 実行状況の追跡
6. **結果収集**: 完了したタスクの結果統合
7. **サマリー提供**: 全体の実行結果報告

### 技術仕様

- **ベースツール**: Task tool (Claude Code)
- **並列処理**: 複数Task toolの同時実行
- **状態管理**: 各サブエージェントの独立状態
- **通信方式**: 結果のみの単方向通信

## トラブルシューティング

### よくある問題

#### サブエージェントが応答しない
- システムリソース不足の可能性
- タスク内容が曖昧すぎる可能性
- 再実行または内容の具体化を検討

#### ファイル競合が発生
- 同じファイルを複数のサブエージェントが変更
- タスクの分割方法を見直し

#### 結果が期待と異なる
- タスク記述の具体性不足
- より詳細な指示で再実行

### デバッグ手法

1. **ログ確認**: 各サブエージェントの実行ログ
2. **状態確認**: Git status、ファイル変更状況
3. **依存関係**: タスク間の依存関係確認

## セキュリティ考慮事項

- サブエージェントによる機密情報の取り扱い
- ファイルアクセス権限の適切な制御
- 外部ネットワークアクセスの制限

## パフォーマンス最適化

- 同時実行数の動的調整
- リソース使用量のモニタリング
- タスクの優先度付け

## 今後の拡張計画

- タスクの依存関係管理
- 実行結果のキャッシュ機能
- サブエージェント間の通信機能
- Web UIでの進捗可視化

---

**Note**: この機能は開発効率向上のための実験的機能です。本格運用前に十分なテストを行ってください。